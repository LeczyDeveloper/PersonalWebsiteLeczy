(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{"33Kz":function(e,t,i){"use strict";i.d(t,"b",(function(){return s})),i.d(t,"a",(function(){return o}));i("mlET"),i("Ysgh"),i("kYxP");var n=i("wrlS");const a=()=>n.b.getArrayValue("dm_reactions_config_active_reactions"),r=()=>{const e=n.b.getArrayValue("dm_reactions_config_inactive_reactions");return[...a(),...e]},s=e=>{const t=r().find(t=>t.endsWith(e));if(t)return t.split(":")[0]},o=(e={includeInactive:!1})=>e.includeInactive?r().map(e=>e.split(":")[1]):a().map(e=>e.split(":")[1])},"5Ixf":function(e,t,i){"use strict";i("IAdD");var n=i("ERkP"),a=i("Lsrn"),r=i("k/Ka");const s=(e={})=>Object(r.a)("svg",Object.assign({},e,{style:[a.a.root,e.style],viewBox:"0 0 24 24"}),n.createElement("g",null,n.createElement("path",{d:"M10 20.5c0 .828-.672 1.5-1.5 1.5h-2c-.828 0-1.5-.672-1.5-1.5v-17C5 2.672 5.672 2 6.5 2h2c.828 0 1.5.672 1.5 1.5v17zm9 0c0 .828-.672 1.5-1.5 1.5h-2c-.828 0-1.5-.672-1.5-1.5v-17c0-.828.672-1.5 1.5-1.5h2c.828 0 1.5.672 1.5 1.5v17z"})));s.metadata={width:24,height:24},t.a=s},"883S":function(e,t,i){"use strict";i.d(t,"a",(function(){return _})),i.d(t,"b",(function(){return y}));var n=i("k49u"),a=i("3XMw"),r=i.n(a),s=i("fs1G");const o=r.a.c3752568,c=r.a.f9690dc0,l=r.a.i859a9d3,d=r.a.b1d35407,u=r.a.g539cca6,p=r.a.bbac0019,h=r.a.a1d2a68d,m=r.a.d4f2d9d8,b=r.a.hf383be4,g=r.a.b25c5b2a,v=r.a.c4fdbd16,f=r.a.hf3e7e38,_={[n.a.DirectMessageConversationNotFound]:{customAction:()=>!1}},y={defaultToast:{text:o},[n.a.CurrentUserSuspended]:{toast:{text:u,action:{label:l,link:"https://support.twitter.com/articles/15790"}}},[n.a.DirectMessageCannotDmOtherUser]:{toast:{text:c}},[n.a.DirectMessageDuplicate]:{toast:{text:g}},[n.a.DirectMessageOtherUserNotFollowing]:{toast:{text:h,action:{label:l,link:"https://support.twitter.com/articles/14606"}}},[n.a.DirectMessagesSenderBlocksRecipient]:{toast:{text:v}},[n.a.DirectMessageTooLongError]:{toast:{text:p}},[n.a.DirectMessageTweetNotFound]:{toast:{text:m}},[n.a.GenericBadRequest]:{customAction:s.a},[n.a.MessageSendError]:{toast:{text:f}},[n.a.OverStatusUpdateLimit]:{toast:{action:{label:l,link:"https://support.twitter.com/articles/15364"},text:d}},[n.a.TargetUserNotFound]:{toast:{text:b}},showToast:!0}},"8eiz":function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"a",(function(){return a})),i.d(t,"c",(function(){return r}));const n=()=>Math.random()>.5?1:-1;function a(e=1,t=0){return Math.random()*(e-t)+t}const r=e=>({width:e,height:e})},AQOc:function(e,t,i){"use strict";i.d(t,"b",(function(){return u})),i.d(t,"a",(function(){return p}));i("IAdD"),i("kYxP");var n=i("LdEA"),a=i.n(n),r=i("lnti"),s=i("aWyx");const o={entries:{},entryIdsByConversationId:{},reactionsByMessageId:{}},c=(e=[],t={})=>e.map(e=>{if(e.proof_type===s.d.MUTUAL_FRIENDS){const{users:i}=e,n=a()(e,["users"]);return Object.assign({},n,{users:Object(r.a)(i.map(e=>t[e]))})}return e}),l=(e=[],t={})=>e.reduce((e,i)=>{const n=i.user_id,a=t[n]||{id_str:n};return e[n]=Object.assign({},i,{user:a}),e},{}),d=(e,{entries:t,entryIdsByConversationId:i})=>(i[e]||[]).map(e=>t[e]&&t[e].data).filter(Boolean),u=(e,t=o,i)=>{const{conversation_id:n,participants:r}=e,s=a()(e,["conversation_id","participants"]);return Object.assign({conversation_id:n},s,{entries:t.entryIdsByConversationId[n]||[],participants:l(r,i)})},p=(e,t,i)=>{const{conversation_id:n,participants:r,social_proof:s}=e,o=a()(e,["conversation_id","participants","social_proof"]);return Object.assign({conversation_id:n},o,{entries:d(n,t),participants:l(r,i)},s?{social_proof:c(s,i)}:{})}},B3eJ:function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var n=i("ERkP"),a=i("U+Jl"),r=i("8eiz"),s=i("mtvn");const o=Object(s.a)(0,20);function c(e){const{color:t,size:i}=e,s=n.useRef({scales:o.map(()=>u(0))}),c=e.paused?0:e.audioLevel,d=Math.floor(Object(r.a)(5,2));return s.current.scales.forEach((e,t)=>{if(t%d!=0)return e;s.current.scales[t]=u(c)}),n.createElement(n.Fragment,null,o.map(e=>n.createElement(a.a,{color:t,key:e,opacity:.05,scale:s.current.scales[e],size:i,translate:l})))}const l={x:0,y:0},d={circleMinimumScale:.05,circleMaximumScale:.5,circlePositionOffset:10,circleRandomNoise:.2,circleScaleRandomProportion:.1};function u(e,t=d){const i=(e+Object(r.a)(t.circleRandomNoise))/(1+t.circleRandomNoise),n=Object(r.a)(1)*t.circleScaleRandomProportion+i*(1-t.circleScaleRandomProportion);return 1+t.circleMinimumScale+n*(t.circleMaximumScale-t.circleMinimumScale)}},GSsg:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var n=i("B5iK");class a{constructor(e,t=Object.freeze({})){const{interval:i=6e4,burstInterval:a=3e3,burstDuration:r=3e5}=t;this.pollTimer=new n.b(i).interval(e),this.burstTimer=new n.a(this.pollTimer,a,r)}start(e){return this.pollTimer.start(),e&&this.burstTimer.requestBurst(),this}stop(){return this.burstTimer.stopBurst(),this.pollTimer.stop(),this}restart(){return this.stop(),this.start(),this}}},H4nC:function(e,t,i){"use strict";var n=i("ERkP"),a=i("3XMw"),r=i.n(a),s=i("MWbm"),o=i("rHpw"),c=i("t62R");const l=o.a.create(e=>({root:{paddingBottom:e.spaces.medium}})),d=r.a.d84b485d,u=r.a.be0c83d7;t.a=({entry:e,isCompact:t})=>{const i="follow"===e.reason?d:u;return t?n.createElement(c.c,{color:"gray600"},i):n.createElement(s.a,{style:l.root},n.createElement(c.c,{align:"center",color:"gray600",size:"small"},i))}},"I2k/":function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var n=i("k49u"),a=i("lRnM"),r=i("LVU8");const s=e=>({[n.a.ClientNotPermitted]:{customAction:()=>(Object(r.d)("/messages",{statusCode:401}),Object(a.t)(e))}})},J2UM:function(e,t,i){"use strict";var n=i("0JOx");t.a=()=>Object(n.h)().then(({inputDetect:e})=>e)},"MH+I":function(e,t,i){"use strict";i.d(t,"a",(function(){return u}));var n=i("97Jx"),a=i.n(n),r=i("LdEA"),s=i.n(r),o=i("ERkP"),c=i("t62R"),l=i("3XMw"),d=i.n(l);function u(e){const{timeMs:t,accessibilityLabelTime:i,countdown:n,humanReadable:r,style:l,short:d}=e,u=s()(e,["timeMs","accessibilityLabelTime","countdown","humanReadable","style","short","withCountdownSymbol"]);if("number"!=typeof t)return null;const h=x(t,n,d),b=S(h,e),R=`PT${h.hours}H${h.minutes}M${h.seconds}S`;let A;A=d||r?C(h,function(e){if(e.short)return{seconds:g,minutes:f,hours:y};return{seconds:v,minutes:_,hours:E}}(e)):b;const w=[p.timestamp,l],I=i?i(b):m({time:b});return o.createElement(c.c,a()({},u,{accessibilityLabel:I,hoverLabel:{label:I},style:w}),o.createElement("time",{dateTime:R},A))}const p=i("rHpw").a.create(e=>({timestamp:{flexShrink:0,whiteSpace:"nowrap",fontVariant:["tabular-nums"]}})),h=e=>e>=10?e:"0"+e,m=d.a.ebe41366,b=d.a.efce3d9a,g=d.a.i61fef37,v=d.a.i3b7a017,f=d.a.ba705e26,_=d.a.ie5d110e,y=d.a.j86b0d8c,E=d.a.df5f11b3;const C=({seconds:e,minutes:t,hours:i},n)=>e||t||i?b({seconds:e?n.seconds(e):"",minutes:t?n.minutes(t):"",hours:i?n.hours(i):""}):n.seconds(0),S=(e,{withCountdownSymbol:t})=>{const i=(({seconds:e,minutes:t,hours:i})=>{const n=h(e),a=`${i?h(t):t}:${n}`;return i?`${i}:${a}`:a})(e);return t?"-"+i:i},x=(e,t,i)=>{const n=(t?Math.ceil:Math.floor)(e/1e3),a=Math.floor(n/3600),r=Math.floor(n%3600/60),s={seconds:Math.floor(n%60),minutes:r,hours:a};return i&&(a?(s.minutes=0,s.seconds=0):r&&(s.seconds=0)),s}},MMRb:function(e,t,i){"use strict";i.r(t);var n=i("9OUN"),a=i("lRnM"),r=i("uKEd"),s=i("AQ79");i.d(t,"GLOBAL_STATE_KEY",(function(){return s.a}));var o=i("xPna"),c=i("Ssj5"),l=i("xCUF"),d=i("aWyx");i.d(t,"CONVERSATION_TYPE",(function(){return d.a})),i.d(t,"ENTRY_TYPE",(function(){return d.b})),i.d(t,"PAGINATION_STATUS",(function(){return d.c})),i.d(t,"addParticipants",(function(){return a.d})),i.d(t,"selectConversation",(function(){return a.u})),i.d(t,"selectConversationAvatarMediaId",(function(){return a.v})),i.d(t,"selectConversationFetchStatus",(function(){return a.y})),i.d(t,"selectConversationIsLoaded",(function(){return a.z})),i.d(t,"selectConversationIsRead",(function(){return a.A})),i.d(t,"selectConversationAvatarMediaIsUploading",(function(){return a.w})),i.d(t,"selectConversationAvatarMediaUploadProgress",(function(){return a.x})),i.d(t,"selectConversations",(function(){return a.C})),i.d(t,"selectHasConversations",(function(){return a.D})),i.d(t,"selectEntries",(function(){return r.l})),i.d(t,"selectEntriesForConversation",(function(){return r.m})),i.d(t,"selectEntry",(function(){return r.n})),i.d(t,"selectConversationIdsByInbox",(function(){return o.n})),i.d(t,"selectFetchStatus",(function(){return o.q})),i.d(t,"selectInboxIsLoaded",(function(){return o.r})),i.d(t,"selectIsLoadingTop",(function(){return o.s})),i.d(t,"selectUnreadCount",(function(){return o.u})),i.d(t,"selectUntrustedCursor",(function(){return o.w})),i.d(t,"selectUntrustedUnreadCount",(function(){return o.z})),i.d(t,"selectUntrustedConversationCount",(function(){return o.v})),i.d(t,"selectUntrustedLowQualityCursor",(function(){return o.y})),i.d(t,"selectUntrustedLowQualityConversationCount",(function(){return o.x})),i.d(t,"selectPoppedOutConversationId",(function(){return o.t})),i.d(t,"selectDrawerVisibility",(function(){return o.p})),i.d(t,"selectDrawerExperimentEnabled",(function(){return o.o})),i.d(t,"selectUpdates",(function(){return l.e})),i.d(t,"acceptConversation",(function(){return a.a})),i.d(t,"addAvatarMedia",(function(){return a.b})),i.d(t,"addWelcomeMessageToConversation",(function(){return a.e})),i.d(t,"disableMentionNotifications",(function(){return a.g})),i.d(t,"disableNotifications",(function(){return a.h})),i.d(t,"enableMentionNotifications",(function(){return a.i})),i.d(t,"enableNotifications",(function(){return a.j})),i.d(t,"fetchConversation",(function(){return a.k})),i.d(t,"fetchConversationFromParticipants",(function(){return a.l})),i.d(t,"fetchConversationIfNeeded",(function(){return a.n})),i.d(t,"fetchConversationHistory",(function(){return a.m})),i.d(t,"leaveConversation",(function(){return a.o})),i.d(t,"markAllAsRead",(function(){return a.p})),i.d(t,"markConversationRead",(function(){return a.q})),i.d(t,"muteDMUser",(function(){return a.r})),i.d(t,"unmuteDMUser",(function(){return a.G})),i.d(t,"removeAvatarMedia",(function(){return a.s})),i.d(t,"removeConversation",(function(){return a.t})),i.d(t,"setConversationAvatar",(function(){return a.E})),i.d(t,"toggleNotifications",(function(){return a.F})),i.d(t,"updateConversationReadState",(function(){return a.L})),i.d(t,"updateConversationAvatar",(function(){return a.H})),i.d(t,"updateConversationName",(function(){return a.J})),i.d(t,"updateTyping",(function(){return a.M})),i.d(t,"fetchInbox",(function(){return o.e})),i.d(t,"fetchInboxIfNeeded",(function(){return o.f})),i.d(t,"fetchTrustedInboxHistory",(function(){return o.g})),i.d(t,"fetchUntrustedInboxHistory",(function(){return o.h})),i.d(t,"fetchUntrustedLowQualityInboxHistory",(function(){return o.i})),i.d(t,"updateLastSeenEventId",(function(){return o.C})),i.d(t,"updateTrustedLastSeenEventId",(function(){return o.D})),i.d(t,"updateUntrustedLastSeenEventId",(function(){return o.E})),i.d(t,"popOutConversation",(function(){return o.m})),i.d(t,"setDrawerVisibility",(function(){return o.B})),i.d(t,"loadDrawerVisibilityFromPersistence",(function(){return o.l})),i.d(t,"setDrawerExperimentEnabled",(function(){return o.A})),i.d(t,"loadDrawerExperimentFromPersistence",(function(){return o.k})),i.d(t,"deleteEntry",(function(){return r.f})),i.d(t,"markSpamStatus",(function(){return r.h})),i.d(t,"removeEntry",(function(){return r.j})),i.d(t,"fetchUpdates",(function(){return l.b})),i.d(t,"fetchUpdatesIfNeeded",(function(){return l.d}));const u=Object(n.c)({conversations:a.f,entries:r.e,inbox:o.d,updates:l.a});c.a.register({[s.a]:u}),t.default=u},OhSZ:function(e,t,i){"use strict";i.d(t,"a",(function(){return d}));i("kYxP");var n=i("ERkP"),a=i("aWyx"),r=i("XnpN"),s=i("jV+4"),o=i("t62R"),c=i("p9G8");const l=(e=[])=>e.map(({data:e})=>e),d=({conversation:e,newConversationParticipants:t,perspective:i})=>{if(e){if(e.type===a.a.ONE_TO_ONE){const[t]=Object(r.a)(e,i).map(({user:e})=>e);return t.name}return Object(c.a)(e,i)}{const e=l(t);return Object(c.b)(e,i)}};t.b=({conversation:e,newConversationParticipants:t,perspective:i,titleWeight:d="bold",textColor:u="normal",withScreenName:p=!0})=>{if(e){if(e.type===a.a.ONE_TO_ONE){const[t]=Object(r.a)(e,i).map(({user:e})=>e);return n.createElement(s.a,{color:u,isProtected:t.protected,isVerified:t.verified,name:t.name,screenName:t.screen_name,weight:d,withLink:!1,withScreenName:p})}return n.createElement(o.c,{color:u,numberOfLines:1,weight:d},Object(c.a)(e,i))}{const e=l(t);return n.createElement(o.c,{color:u,numberOfLines:1,weight:d},Object(c.b)(e,i))}}},Oi4X:function(e,t,i){"use strict";i("IAdD"),i("JtPf"),i("Qavd"),i("MvUL"),i("kYxP");var n=i("KEM+"),a=i.n(n),r=i("ERkP"),s=i("0JOx"),o=i("zh9S"),c=i("MMRb"),l=i("VnFT"),d=i("RqPI"),u=i("1YZw"),p=i("oEGd"),h=i("0KEI"),m=i("hqKg"),b=i("kGix"),g=i("Myq3"),v=i("AQOc"),f=i("UhuB"),_=i("pNZL"),y=i("G6rE"),E=i("P1r1"),C=i("X/yg");const S=(e,t)=>t.conversationId,x=Object(m.createSelector)(c.selectFetchStatus,(e,t)=>c.selectConversationFetchStatus(e,S(0,t)),(e,t)=>e===b.a.LOADED?t:e),R=Object(m.createSelector)((e,t)=>c.selectEntriesForConversation(e,S(0,t)),d.h,(e,t)=>t?((e,t)=>{const i=Object(g.a)(e,e=>!!e.message_data&&(e.message_data&&e.message_data.recipient_id===t));return i&&i.message_data&&i.message_data.quick_reply&&i.message_data.quick_reply&&"options"===i.message_data.quick_reply.type?i.message_data.quick_reply:void 0})(e,t):void 0),A=Object(m.createSelector)((e,t)=>c.selectConversation(e,S(0,t)),c.selectEntries,C.c,d.h,C.d,C.e,y.e.selectAll,x,(e,t)=>c.selectConversationIsLoaded(e,S(0,t)),(e,t)=>l.g(e,S(0,t)),(e,t)=>l.j(e,S(0,t)),(e,t)=>l.i(e,S(0,t)),(e,t)=>l.k(e,S(0,t)),(e,t)=>l.l(e,S(0,t)),(e,t)=>l.h(e,S(0,t)),(e,t)=>l.m(e,S(0,t)),E.k,f.l,R,E.n,(e,t,i,n,a,r,s,o,c,l,d,u,p,h,m,b,g,f,_,y)=>{const E=e&&e.data;return{conversation:E&&Object(v.a)(E,t,s),dataSaverMode:g,draftText:b,dtabBarInfo:y,fetchStatus:o,gifMetadata:m,isDmReceiptSettingEnabled:f,isLoaded:c,cardUrl:l,isNewGroupConversation:i,isUploading:d,media:u,mediaMetadata:p,mediaUploadProgress:h,newConversationParticipants:a,perspective:n,quickReplyOptions:_,tweetAttachment:r}}),w=e=>()=>l.b(e),I=e=>t=>l.c(e,t);var O=Object(p.d)(A,e=>{return{acceptConversation:c.acceptConversation,addMedia:(t=e.conversationId,(e,i)=>l.a(t,e,i)),saveText:l.f,addToast:u.b,addWelcomeMessageToConversation:c.addWelcomeMessageToConversation,cancelUpload:w(e.conversationId),createLocalApiErrorHandler:Object(h.d)("DIRECT_MESSAGES_CONVERSATION"),fetchConversationHistory:c.fetchConversationHistory,fetchConversationIfNeeded:c.fetchConversationIfNeeded,fetchInboxIfNeeded:c.fetchInboxIfNeeded,fetchUpdatesIfNeeded:c.fetchUpdatesIfNeeded,googleAnalyticsPageView:o.a,leaveConversation:c.leaveConversation,removeMedia:I(e.conversationId),removeText:l.d,scribeAction:o.c,scribePageImpression:o.d,sendMessage:l.n,updateConversationReadState:c.updateConversationReadState,updateTweetDetailNav:_.b,updateTyping:c.updateTyping,removeConversation:c.removeConversation,popOutConversation:c.popOutConversation};var t}),M=i("7JQg"),T=i("I2k/"),k=i("wrlS"),L=i("n+Zb"),D=(i("6/0d"),i("IRWI")),F=i("VPAj");const P=(e,t)=>e.getForItem(t).doesIntersectWith(e.getForViewport()),j=e=>e.getForList().getBottom()-e.getForViewport().getBottom();var B=({isOwnMessage:e,typingIndicatorId:t})=>{const i=e=>Object(g.a)(e.getList(),e=>e.id!==t);return Object.assign({},D.a,{initialScrollHeadroom:Object(F.a)(0),scrollHeadroom:Object(F.a)(0),offsetCorrection:(n,a)=>{const r=n.getForViewport().getBottom(),s=n.getForList().getBottom(),o=r>=s||Math.abs(r-s)<=2,c=i(n),l=i(a),d=j(n),u=j(a),p=l&&(!c||c.id!==l.id),h=l&&e(l.data.data),m=c&&P(n,c.id),b=!p&&u>d;return p&&(h||m)||m&&((e,i)=>{const n=e.getForItem(t),a=i.getForItem(t);return!n||a&&a.getHeight()>n.getHeight()})(n,a)||o&&b?Math.max(0,j(a)):D.a.offsetCorrection(n,a)}})},N=i("aWyx");const U=(e,t)=>({entry:{id:t,time:"",type:e},isActive:!1,isRapidFire:!1,isFirstRapidFire:!1,isLastRapidFire:!1,type:e}),W=U(N.b.CONVERSATION_PROFILE_INFO_HEADER,"conversationProfileInfoHeader"),H=U(N.b.TYPING_INDICATOR,"typingIndicator"),z=U(N.b.READ_ONLY_INDICATOR,"readOnlyIndicator");var V=i("b9JY");var q=(e,t)=>{if(e&&e.message_data&&t&&t.message_data&&Object(V.b)(e)&&Object(V.b)(t)){const{sender_id:i,time:n}=e.message_data,{sender_id:a,time:r}=t.message_data,s=parseInt(r,10)-parseInt(n,10);return i===a&&s>=0&&s<=6e4}return!1},G=i("jat/"),Q=(i("jQ/y"),i("v6aA")),Y=i("XnpN"),K=i("LhSm"),$=i("I4+6"),J=i("rHpw"),X=i("PbQQ"),Z=i("cm6r"),ee=i("jV+4"),te=i("pBrB"),ie=i("wCd/");const ne=(e,t)=>{const i=Object(Y.a)(e,t).map(({user:e})=>e),n=i&&i[0];return{userDescription:n.description,userEntities:n.entities,userWithheldDescription:n.withheld_description,userWithheldEntities:n.withheld_entities,userFollowerCount:n&&n.followers_count,userFriendsCount:n&&n.friends_count,userIdStr:n&&n.id_str,userJoinDate:n&&n.created_at,userName:n&&n.name,userScreenName:n&&n.screen_name,userIsVerified:n&&n.verified}},ae=J.a.create(e=>({root:{flexDirection:"column",alignItems:"center",marginBottom:e.spaces.small,paddingVertical:e.spaces.medium,paddingHorizontal:e.spaces.small,borderRadius:e.borderRadii.xSmall},profileInfoItemMargin:{marginBottom:e.spaces.xxSmall},borderBottom:{borderBottomWidth:e.borderWidths.small,borderBottomColor:e.colors.borderColor,borderBottomStyle:"solid"},description:{width:"100%"}}));var re=({conversation:e,withBottomBorder:t=!0})=>{const{loggedInUserId:i}=r.useContext(Q.a);if(!e)return null;const{userDescription:n,userWithheldDescription:a,userEntities:s,userWithheldEntities:o,userFollowerCount:c,userFriendsCount:l,userIdStr:d,userJoinDate:u,userName:p,userScreenName:h,userIsVerified:m}=ne(e,i||""),b=!!(p&&h&&(c&&l||u)),g=$.a.generate({color:J.a.theme.colors.text,backgroundColor:J.a.theme.colors.transparent,customFocusBackgroundColor:J.a.theme.colors.gray0,customHoverBackgroundColor:J.a.theme.colors.gray0,customPressedBackgroundColor:J.a.theme.colors.activeFaintGray});return r.createElement(X.a.Consumer,null,e=>r.createElement(Z.a,{interactiveStyles:g,link:e.withAnchorless("https://twitter.com/"+(h||"")),style:[ae.root,t&&b&&ae.borderBottom]},r.createElement(ee.a,{isVerified:m,name:p,screenName:h,style:ae.profileInfoItemMargin,weight:"bold",withHoverCard:!0,withLink:!0}),n&&s&&d?r.createElement(te.a,{description:n,entities:s,style:[ae.profileInfoItemMargin,ae.description],userId:d,withheldDescription:a,withheldEntities:o}):null,c&&l?r.createElement(ie.a,{followersCount:c,friendsCount:l,screenName:h||"",style:ae.profileInfoItemMargin,withLink:!1}):null,u?r.createElement(K.a,{joinDate:u}):null))},se=i("g54k"),oe=i("aA19"),ce=i("mN6z"),le=i("MWbm"),de=i("t62R"),ue=i("oSwX"),pe=i("MAI/"),he=i("zQEV");const me=({children:e,link:t,style:i})=>r.createElement(de.c,{align:"center",color:"gray600",link:t,size:"small",style:i},e);class be extends r.Component{constructor(...e){super(...e),a()(this,"_renderContents",()=>{const{conversation:e,entry:t,entryType:i,perspective:n,users:a}=this.props,s=Object(he.a)(t,i,n,a);switch(i){case N.b.CONVERSATION_AVATAR_UPDATE:return r.createElement(r.Fragment,null,this._isValidImageSource(t.conversation_avatar_image_https)?r.createElement(le.a,{style:ge.conversationAvatarContainer},r.createElement(oe.a,{conversation:e,perspective:n})):null,r.createElement(me,null,s));case N.b.JOIN_CONVERSATION:{const e=this._getAddedYouMessageWithProfileInfo(s),t=this._getParticipantsFromEntry(),i=r.createElement(de.c,{align:"center",color:"gray600",size:"small"},this._getParticipantsFromEntryText(t)),n=this._getJoinConversationDetailsWithFacepile(t,i);return r.createElement(r.Fragment,null,e,n)}default:return r.createElement(me,null,s)}}),a()(this,"_getAddedYouMessageWithProfileInfo",e=>{const{entry:t,users:i}=this.props,n=t.sender_id?i[t.sender_id]:void 0,a=n?{pathname:"https://twitter.com/"+n.screen_name}:void 0;return r.createElement(Z.a,{interactiveStyles:null,link:a,style:ge.userAddedYouContainer},n?r.createElement(ue.default,{accessibilityLabel:n.screen_name,screenName:n.screen_name,size:"medium",uri:n.profile_image_url_https,withHoverCard:!0,withLink:!0}):null,r.createElement(me,{link:a,style:ge.userAddedYouText},e))}),a()(this,"_getJoinConversationDetailsWithFacepile",(e,t)=>{const{conversation:i}=this.props,n=e.slice(0,20).map(({profile_image_url_https:e})=>e);return r.createElement(Z.a,{interactiveStyles:null,link:{pathname:`/messages/${i.conversation_id}/participants`},style:ge.joinConversationDetails},t,r.createElement(pe.a,{style:ge.userAvatarFacepile,userAvatarSize:"xLarge",userAvatarUrls:n}))})}shouldComponentUpdate(e){return!Object(ce.a)(this.props,e)}render(){return r.createElement(le.a,{style:ge.root},this._renderContents())}_isValidImageSource(e){return e&&""!==e&&e.indexOf("MEDIA_NOT_FOUND")<0}_getParticipantsFromEntry(){const{entry:e,perspective:t,users:i}=this.props;return e.participants?e.participants.filter(({user_id:e})=>t!==e).map(({user_id:e})=>i[e]).filter(Boolean):[]}_getParticipantsFromEntryText(e){const{conversation:{conversation_id:t}}=this.props;return Object(he.b)(e.length,t)}}const ge=J.a.create(e=>({root:{paddingBottom:e.spaces.medium},conversationAvatarContainer:{alignSelf:"center",height:e.spaces.jumbo,marginBottom:e.spaces.xSmall,width:e.spaces.jumbo},userAddedYouContainer:{flexDirection:"row",justifyContent:"center"},userAddedYouText:{flexShrink:1,marginLeft:e.spaces.xSmall},joinConversationDetails:{marginTop:e.spaces.xxSmall},userAvatarList:{marginTop:e.spaces.xxSmall},userAvatarFacepile:{marginTop:e.spaces.xxSmall,justifyContent:"center"}}));var ve=Object(se.a)(be),fe=i("oQhu");var _e=Object(fe.a)((function(e){const t=J.a.theme.spacesPx.xLarge;return{DMUserAvatarSizeType:"xLarge",DMUserAvatarSizePx:t,DMUserAvatarSpacerPx:t+J.a.theme.spacesPx.xSmall}})),ye=i("shC7"),Ee=i("38/B");const Ce=function(e){return Se(e,Ee.a.reducedMotionEnabled)},Se=Object(fe.a)((function(e,t){const i=function(){const{DMUserAvatarSizePx:e,DMUserAvatarSpacerPx:t}=_e(J.a.theme.scale),i=Ae[J.a.theme.scale],n=xe/i,a=Re/e,r=Re/2,s=Re-r,o=Re-r-t;return{cssTransition:Ee.a.reducedMotionEnabled?{}:{transition:`transform ${Ie}, opacity ${Ie}`},messageContainer:{base:{transform:[{translateX:0}]},active:{sent:{transform:[{translateX:(ye.a.isRTL?1:-1)*s}]},received:{transform:[{translateX:(ye.a.isRTL?-1:1)*o}]}}},actionsContainer:{base:{transform:[{translateX:0}]},active:{sent:{transform:[{translateX:(ye.a.isRTL?1:-1)*we[J.a.theme.scale]}]},received:{transform:[{translateX:(ye.a.isRTL?-1:1)*(we[J.a.theme.scale]+o)-r}]}}},voiceMessage:{container:{base:{height:i},active:{height:xe}},base:{height:i,transform:[{scale:1}]},active:{base:{transform:[{scale:n}]},sent:{paddingRight:r/n,transformOrigin:ye.a.isRTL?"bottom left":"bottom right"},received:{paddingLeft:r/n,transformOrigin:ye.a.isRTL?"bottom right":"bottom left"}}},userAvatar:{base:{transform:[{scale:1}]},sent:{transformOrigin:ye.a.isRTL?"bottom left":"bottom right"},received:{transformOrigin:ye.a.isRTL?"bottom right":"bottom left"},active:{opacity:1,pointerEvents:"all",transform:[{scale:a}]},visuallyHidden:{opacity:0,pointerEvents:"none"}}}}();return{actionsContainer:function({isSent:e,isVoiceMessageActive:t}){const n=[i.cssTransition,i.actionsContainer.base];return t&&n.push(e?i.actionsContainer.active.sent:i.actionsContainer.active.received),n},messageContainer:function({isSent:e,isVoiceMessageActive:t}){const n=[i.cssTransition,i.messageContainer.base];return t&&n.push(e?i.messageContainer.active.sent:i.messageContainer.active.received),n},voiceMessageContainer:function({isSent:e,isVoiceMessageActive:t}){const n=[i.cssTransition,i.voiceMessage.container.base];return t&&n.push(i.voiceMessage.container.active),n},voiceMessage:function({isSent:e,isVoiceMessageActive:t}){const n=[i.cssTransition,i.voiceMessage.base];return t&&(n.push(i.voiceMessage.active.base),n.push(e?i.voiceMessage.active.sent:i.voiceMessage.active.received)),n},userAvatar:function({isSent:e,isVoiceMessageActive:t}){const n=[i.cssTransition,i.userAvatar.base,e?i.userAvatar.sent:i.userAvatar.received];return t?n.push(i.userAvatar.active):e&&n.push(i.userAvatar.visuallyHidden),n}}}));const xe=60,Re=xe,Ae={xSmall:42,small:42,normal:47,large:47,xLarge:47},we={xSmall:72.26,small:165.61-89.3,normal:158.22-94.4,large:166.64-100.58,xLarge:181.55-111.81},Ie="0.2s 0s ease-in-out",Oe={scribeAction:o.c},Me=Object(m.createSelector)((e,t)=>y.e.select(e,t.senderId),E.l,E.q,(e,t,i)=>({user:e,displaySensitiveMedia:t,isDmNsfwMediaFilterEnabled:i}));var Te=Object(p.g)(Me,Oe);const ke={addToast:u.b,createLocalApiErrorHandler:Object(h.d)("DIRECT_MESSAGES_OVERFLOW_ACTIONS"),deleteEntry:c.deleteEntry};var Le=Object(p.b)(ke),De=i("k49u"),Fe=i("LVU8"),Pe=i("3XMw"),je=i.n(Pe);const Be=je.a.f58dff33,Ne=je.a.ad5a8e8e,Ue={[De.a.MissingParameter]:{toast:Object(Fe.a)(Be)},[De.a.DirectMessageDestroyPermissionsError]:{toast:{text:Ne}},showToast:!0};i("x4t0");var We=i("xCUF"),He=i("uKEd");const ze=[],Ve=Object(m.createSelector)(e=>Object(He.l)(e).entries,(e,t)=>Object(He.p)(e,t.entry.id)||ze,(e,t)=>t.perspective,(e,t,i)=>({selectedReactions:t.filter(t=>{const n=e[t]&&e[t].data;return n&&n.sender_id===i}).map(t=>e[t].data.reaction_key)})),qe={createReaction:He.d,createLocalApiErrorHandler:Object(h.d)("DIRECT_MESSAGES_REACTIONS_POPOVER"),fetchUpdatesIfNeeded:We.d,removeReaction:He.k};var Ge=Object(p.g)(Ve,qe),Qe=i("33Kz"),Ye=i("wTX1");var Ke=({accessible:e,accessibilityLabelFormatter:t,count:i,emojiSize:n,emotion:a,enableHoverStyle:s,onPress:o,style:c})=>{const l=Object(Qe.b)(a),d=t&&l?t({emoji:l,count:i}):void 0,u=$.a.generate({backgroundColor:J.a.theme.colors.gray50,color:J.a.theme.colors.gray600});return r.createElement(Z.a,{accessibilityLabel:d,accessible:e,interactiveStyles:s?u:null,onPress:o,style:[$e.container,...c||[]]},r.createElement(de.c,{size:n,style:$e.unsetLineHeight},l),i&&r.createElement(Ye.a,{color:"gray600",containerStyle:$e.count,count:i,size:"xSmall"},i))};const $e=J.a.create(e=>({container:{flexDirection:"row"},count:{alignSelf:"center",minWidth:e.spaces.small,paddingLeft:e.spaces.micro},unsetLineHeight:{lineHeight:"unset"}}));var Je=i("Irs7");const Xe=je.a.ca7a2214,Ze=je.a.fc0e94b7;class et extends r.Component{constructor(...e){super(...e),a()(this,"_handleReactionScribing",(e,t)=>{const{analytics:i}=this.props,n=t?"delete_reaction":"create_reaction";i.scribe({section:"twitter_service",component:"direct_messages",element:n,action:"success",data:{reaction_emotion:e}})}),a()(this,"_reactionClickHandler",(e,t)=>()=>{const{createReaction:i,createLocalApiErrorHandler:n,dismiss:a,fetchUpdatesIfNeeded:r,removeReaction:s,entry:o,perspective:c}=this.props,l={reaction_key:e,conversation_id:o.conversation_id,dm_id:o.id,perspective:c};(t?s:i)(l).then(this._handleReactionScribing(e,t)).then(()=>r()).catch(n()),a()})}render(){const{selectedReactions:e}=this.props,t=Object(Qe.a)().map(t=>{const i=e.includes(t);return r.createElement(Ke,{accessibilityLabelFormatter:i?Xe:Ze,accessible:!0,emojiSize:"xLarge",emotion:t,enableHoverStyle:!0,key:t,onPress:this._reactionClickHandler(t,i),style:[it.reaction,i&&it.selectedReaction]})});return r.createElement(le.a,{style:it.reactions},t)}}var tt=Object(Je.a)(Ge(et));const it=J.a.create(e=>({reactions:{cursor:"pointer",flexDirection:"row",padding:e.spaces.xSmall},reaction:{borderRadius:e.borderRadii.small,padding:e.spaces.xxSmall},selectedReaction:{backgroundColor:e.colors.gray50}}));var nt=i("OiMc");class at extends r.Component{constructor(...e){super(...e),a()(this,"_renderDMReactionPickerContent",e=>{const{entry:t,perspective:i}=this.props;return r.createElement(tt,{dismiss:e,entry:t,perspective:i})})}render(){const{children:e,onDismiss:t}=this.props;return r.createElement(nt.a,{enableEnterKeyToggle:!0,onDismiss:t,preferredVerticalOrientation:"up",renderContent:this._renderDMReactionPickerContent,withArrow:!0},e)}}var rt=i("fz3c"),st=i("mjJ+"),ot=i("Q0VY"),ct=i("eb3s"),lt=i("/yvb"),dt=i("ZToW"),ut=i("CaKu"),pt=i("i4Oy"),ht=(i("tVqn"),i("4w6w"));const mt=(e,t)=>{if(null==e)return!1;const[i,n]=t||[0,0];return!((0===i||1===i)&&e.length===n)},bt=e=>{const{message_data:t}=e;if(!t)return!1;const{attachment:i}=t;if(!i)return!0;if(i.sticker)return!1;const n=i.tweet||i.photo||i.animated_gif||i.video||void 0;if(n)return mt(t.text,n.indices);if(i.card){var a;const e=((null==(a=t.entities)?void 0:a.urls)||[]).find(e=>e.url===i.card);return mt(t.text,e&&e.indices)}return!0},gt=e=>{var t;const i=null==e||null==(t=e.message_data)?void 0:t.attachment;return!(!i||!(i.card||i.tweet||i.photo||i.animated_gif||i.video||i.fleet))},vt=e=>{var t;const i=null==e||null==(t=e.message_data)?void 0:t.attachment;return!(!i||!i.fleet)},ft=(e,t,i)=>{const n=1.25*J.a.theme.fontSizesPx.normal;return{compositeRendered:e?void 0!==t&&void 0!==i:void 0!==t,isTextSquared:void 0!==t&&void 0!==i&&(i===t||i<=t-n),isAttachmentSquared:void 0!==i&&void 0!==t&&(t===i||t<=i-n)}};var _t=i("hiGS"),yt=i("zIWA"),Et=i("Lsrn"),Ct=i("k/Ka");const St=(e={})=>Object(Ct.a)("svg",Object.assign({},e,{style:[Et.a.root,e.style],viewBox:"0 0 24 24"}),r.createElement("g",null,r.createElement("path",{d:"M16.925 9.5H14.5V7.075c0-.414-.336-.75-.75-.75s-.75.336-.75.75V9.5h-2.425c-.414 0-.75.336-.75.75s.336.75.75.75H13v2.425c0 .414.336.75.75.75s.75-.336.75-.75V11h2.425c.414 0 .75-.336.75-.75s-.336-.75-.75-.75zm-.3 11H4.25c-.413 0-.75-.337-.75-.75V8.402c0-.414-.336-.75-.75-.75s-.75.336-.75.75V19.75C2 20.99 3.01 22 4.25 22h12.375c.414 0 .75-.336.75-.75s-.336-.75-.75-.75z"}),r.createElement("path",{d:"M19.75 2h-12C6.51 2 5.5 3.01 5.5 4.25v12c0 1.24 1.01 2.25 2.25 2.25h12c1.24 0 2.25-1.01 2.25-2.25v-12C22 3.01 20.99 2 19.75 2zm.75 14.25c0 .413-.337.75-.75.75h-12c-.413 0-.75-.337-.75-.75v-12c0-.413.337-.75.75-.75h12c.413 0 .75.337.75.75v12z"})));St.metadata={width:24,height:24};var xt=St;const Rt=(e={})=>Object(Ct.a)("svg",Object.assign({},e,{style:[Et.a.root,e.style],viewBox:"0 0 24 24"}),r.createElement("g",null,r.createElement("path",{d:"M22.436 16.92H19.76v-2.673c0-.415-.335-.75-.75-.75s-.75.335-.75.75v2.674h-2.676c-.413 0-.75.337-.75.75s.337.75.75.75h2.677v2.677c0 .413.337.75.75.75s.75-.337.75-.75V18.42h2.676c.414 0 .75-.337.75-.75s-.336-.75-.75-.75z"}),r.createElement("path",{d:"M11.088 21.214c-2.61-.046-10.064-6.778-10.064-13.157 0-3.066 2.525-5.755 5.404-5.755 2.29 0 3.83 1.582 4.646 2.73.816-1.148 2.357-2.73 4.646-2.73 2.878 0 5.403 2.69 5.403 5.755 0 1.13-.232 2.323-.69 3.545-.145.39-.58.584-.966.44-.388-.146-.584-.58-.438-.966.394-1.053.594-2.07.594-3.02 0-2.266-1.824-4.254-3.903-4.254-2.525 0-3.94 2.937-3.952 2.966-.23.562-1.155.562-1.387 0-.01-.03-1.425-2.966-3.952-2.966-2.08 0-3.904 1.988-3.904 4.255 0 5.76 7.076 11.63 8.563 11.657.168-.003.764-.195 1.758-.892.343-.238.81-.154 1.045.184.237.34.155.808-.184 1.045-1.085.76-1.966 1.153-2.618 1.164z"})));Rt.metadata={width:24,height:24};var At=Rt,wt=i("FRoe");const It=je.a.ba60339a,Ot=je.a.j4bfee22,Mt=je.a.d96cf7cd,Tt=je.a.faddd3a2,kt=je.a.eb497e08,Lt=je.a.b170974a,Dt=je.a.i202bd22,Ft=je.a.f2e5491a,Pt=je.a.f88553c8;class jt extends r.Component{constructor(e){super(e),a()(this,"_renderOverflowMenu",e=>{const{entry:t,isSent:i,analytics:n}=this.props,a=n.contextualScribeNamespace,s=[{text:It,Icon:_t.a,isEmphasized:!0,onClick:this._handleShowDeleteConfirmation(e)}];return i||s.push({text:Dt,Icon:yt.a,link:{pathname:`/i/report/${rt.a.DMMessage}/${t.id}`,state:{clientReferer:window.location.pathname,conversationId:t.conversation_id,scribeNamespace:a}},onClick:this.props.onReportMessage}),ut.a.isAvailable()&&s.push({text:Ft,Icon:xt,onClick:this._handleCopyMessageText}),r.createElement(st.a,{items:s,onCloseRequested:this._handleHideActionsAndMenus(e),preferredHorizontalOrientation:"right"})}),a()(this,"_handleCopyMessageText",e=>{const{addToast:t}=this.props,i=this._replaceMessageUrls();i&&(ut.a.setString(i),t({text:Pt})),e&&e()}),a()(this,"_handleSetActionsActive",()=>{const{setShouldFreezeUpdates:e}=this.props;this.setState({actionsAreActive:!0}),e(!0)}),a()(this,"_handleDelete",()=>{const{createLocalApiErrorHandler:e,deleteEntry:t,entry:i}=this.props;t({conversationId:i.conversation_id,id:i.id}).catch(e(Ue))}),a()(this,"_handleHideDeleteConfirmation",()=>{this.setState({showDeleteConfirmation:!1})}),a()(this,"_handleHideActionsAndMenus",e=>()=>{const{setShouldFreezeUpdates:t}=this.props;e&&e(),this.setState({actionsAreActive:!1}),t(!1)}),a()(this,"_handlePressReactionPickerButton",()=>{const{analytics:e,entry:t}=this.props;e.scribe({component:"reaction_button",element:Object(C.a)(t),action:"click"}),this._handleSetActionsActive()}),a()(this,"_handleShowDeleteConfirmation",e=>()=>{const{setShouldFreezeUpdates:t}=this.props;e(),this.setState({actionsAreActive:!1,showDeleteConfirmation:!0}),t(!1)}),a()(this,"_replaceMessageUrls",()=>{const{entry:e}=this.props,t=e&&e.message_data&&e.message_data.entities;let i=e&&e.message_data&&e.message_data.text||"";return ot.a.tweetTextParts(i,[0,i.length],t).forEach(e=>{"url"===e.entityType&&(i=i.replace(e.url,e.expandedUrl))}),i}),this.state={actionsAreActive:!1,showDeleteConfirmation:!1},this._hasMedia=gt(this.props.entry),this._isNarrow=pt.a.get("screen").width<J.a.theme.breakpoints.xSmall}render(){const{isSent:e,shouldShowReactionButton:t,style:i}=this.props,n=this._areActionsVisible();return r.createElement(le.a,{pointerEvents:n?"auto":"none",style:[Nt.messageActions,e?Nt.messageActionsLeft:Nt.messageActionsRight,n?Nt.visible:Nt.invisible,this._isNarrow&&(this._hasMedia?Nt.messageActionsMediaNarrow:Nt.messageActionsNarrow),i]},t&&this._renderReactionButton(),this._renderOverflowButton(),this._renderDeleteConfirmation())}_renderDeleteConfirmation(){return this.state.showDeleteConfirmation?r.createElement(ct.a,{confirmButtonLabel:Mt,confirmButtonType:"destructive",headline:Ot,onCancel:this._handleHideDeleteConfirmation,onConfirm:this._handleDelete,text:Tt}):null}_renderReactionButton(){const{entry:e,perspective:t}=this.props,{actionsAreActive:i}=this.state;return r.createElement(at,{entry:e,onDismiss:this._handleHideActionsAndMenus(),perspective:t},r.createElement(lt.a,{accessibilityLabel:Lt,"aria-expanded":i?"true":"false","aria-haspopup":"true",icon:Ut,onPress:this._handlePressReactionPickerButton,size:this._isNarrow?"normalCompact":"normal",type:"text"}))}_renderOverflowButton(){return r.createElement(lt.a,{accessibilityLabel:kt,icon:Wt,onPress:this._handleSetActionsActive,renderMenu:this._renderOverflowMenu,size:this._isNarrow?"normalCompact":"normal",type:"text"})}_areActionsVisible(){const{containerIsActive:e,containerIsFocused:t,containerIsHovered:i,isDraft:n}=this.props,{actionsAreActive:a}=this.state,r=(s=this.props.entry,!bt(s)&&gt(s)&&!dt.a.isEnabled);var s;return!n&&(r||e&&!dt.a.isEnabled||t||i||a)}}var Bt=Object(Je.a)(Le(jt));const Nt=J.a.create(e=>({invisible:{opacity:0},messageActions:{alignSelf:"flex-end",flexDirection:"row"},messageActionsMediaNarrow:{flexDirection:"column"},messageActionsNarrow:{flexShrink:1,flexWrap:"wrap",minWidth:e.spaces.large},messageActionsLeft:{justifyContent:"flex-end",paddingRight:e.spaces.xxSmall},messageActionsRight:{justifyContent:"flex-start",paddingLeft:e.spaces.xxSmall},actionIcon:{color:e.colors.gray600},visible:{opacity:1}})),Ut=r.createElement(At,{style:Nt.actionIcon}),Wt=r.createElement(wt.a,{style:Nt.actionIcon});var Ht=i("97Jx"),zt=i.n(Ht),Vt=i("/MKj");const qt={createLocalApiErrorHandler:Object(h.d)("DIRECT_MESSAGES_CONVERSATION"),removeEntry:c.removeEntry,sendMessage:l.n};var Gt=Object(Vt.b)(null,qt);const Qt=[],Yt=(e,t)=>Object(He.p)(e,t.entryId)||Qt,Kt=e=>Object(He.l)(e).entries,$t={createLocalApiErrorHandler:Object(h.d)("DIRECT_MESSAGES_REACTIONS")};var Jt=Object(p.e)(()=>Object(m.createSelector)(Kt,Yt,d.h,(e,t,i)=>{const n=Object(Qe.a)({includeInactive:!0});let a,r=0;return{reactionsWithCounts:t.reduceRight((t,s)=>{const o=e[s]&&e[s].data;if(!o)return t;if(!n.includes(o.reaction_key))return t;const c=(t.get(o.reaction_key)||0)+1;return t.set(o.reaction_key,c),(null==o?void 0:o.sender_id)===i&&(a=o.reaction_key),r+=1,t},new Map),selectedReactionKey:a,totalReactionCount:r}}),$t);const Xt=[],Zt=(e,t)=>t.entryId,ei=e=>Object(He.l)(e).entries,ti=(e,t)=>Object(He.p)(e,Zt(0,t))||Xt,ii=(e,t)=>y.e.selectMany(e,((e,t)=>Object(He.q)(e,Zt(0,t)))(e,t)),ni={removeReaction:He.k,fetchUpdatesIfNeeded:We.d,createLocalApiErrorHandler:Object(h.d)("DIRECT_MESSAGES_REACTION_SUMMARY_CONTEXT")};var ai=Object(p.e)(()=>Object(m.createSelector)(ei,ti,d.h,ii,(e,t,i,n)=>{const a=Object(Qe.a)({includeInactive:!0}),r=[];t.forEach(t=>{const s=e[t]&&e[t].data;if(!(s&&a.includes(s.reaction_key)))return;const o=n.find(e=>e&&e.id_str===s.sender_id),c=o&&{avatarUri:o.profile_image_url_https,userId:o.id_str,reactionKey:s.reaction_key,isLoggedInUser:o.id_str===i,screenName:o.screen_name,name:o.name,isProtected:o.protected,isVerified:o.verified,time:s.time};c&&r.push(c)}),r.sort((e,t)=>t.time-e.time);const s=r.findIndex(e=>e.userId===i);return s>-1&&r.push(...r.splice(0,s)),{loggedInUserId:i,usersWithReactions:r}}),ni),ri=i("TIdA"),si=i("htQn");const oi=je.a.gf5e9ea6,ci=je.a.a2d48778,li=ri.a.createLayoutCache();class di extends r.Component{constructor(...e){super(...e),a()(this,"_handleUndoReaction",e=>{const{onUndoPress:t}=this.props;e.stopPropagation(),t()})}render(){const{user:e,renderUndo:t,withBottomBorder:i}=this.props,{avatarUri:n,name:a,screenName:s,isProtected:o,isVerified:c}=e,l=r.createElement(ue.default,{imageLayoutCache:li,screenName:s,size:"xxLarge",uri:n}),d=r.createElement(Ke,{accessible:!1,emojiSize:"xLarge",emotion:e.reactionKey}),u=r.createElement(ee.a,{badgeContext:"content",isProtected:o,isVerified:c,name:a,screenName:s,withHoverCard:!0,withStackedLayout:!0});return r.createElement(si.a,{link:{pathname:"/"+s,anchorless:!0},style:[ui.root,i&&ui.bottomBorder]},r.createElement(le.a,{style:ui.reactionColumn},d),r.createElement(le.a,{style:ui.column},l),r.createElement(le.a,{style:ui.bodyColumn},r.createElement(le.a,{style:ui.body},u)),t?r.createElement(le.a,{style:ui.column},r.createElement(lt.a,{accessibilityLabel:ci({emoji:Object(Qe.b)(e.reactionKey)}),onClick:this._handleUndoReaction,size:"normalCompact",type:"text"},oi)):null)}}const ui=J.a.create(e=>({bodyColumn:{flexShrink:1,flexGrow:1,justifyContent:"center",marginHorizontal:e.spaces.xxSmall},body:{alignItems:"center",flexDirection:"row",justifyContent:"space-between"},bottomBorder:{borderBottomColor:e.colors.borderColor,borderBottomStyle:"solid",borderBottomWidth:e.borderWidths.small},column:{alignItems:"center",justifyContent:"center",marginRight:e.spaces.xxSmall},reactionColumn:{alignItems:"center",justifyContent:"center",marginRight:e.componentDimensions.gutterHorizontal},root:{flexDirection:"row",minHeight:"56px",paddingHorizontal:e.componentDimensions.gutterHorizontal,paddingVertical:e.componentDimensions.gutterVertical}}));var pi=di,hi=i("TnY3"),mi=i("xKuM"),bi=i("efqG");const gi=je.a.b772cd65,vi=je.a.c0098d49,fi=je.a.j85999eb;class _i extends r.PureComponent{constructor(...e){super(...e),a()(this,"_renderContent",(e,t)=>r.createElement(le.a,null,this._renderHeader(e,t),this._renderUsers(e,t),this._renderDoneButton(e,t))),a()(this,"_renderHeader",(e,t)=>"sheet"===t?r.createElement(mi.a,{title:vi,withBottomBorder:!0}):r.createElement(de.c,{visuallyHidden:!0},vi)),a()(this,"_renderUsers",(e,t)=>r.createElement(le.a,{accessibilityLabel:fi,style:[yi.container,"sheet"===t?yi.sheet:yi.popover]},this._renderUserCells(e))),a()(this,"_renderDoneButton",(e,t)=>"sheet"===t&&r.createElement(lt.a,{key:"button_done",onPress:e,style:yi.cancelButton,type:"neutral"},gi)),a()(this,"_renderUserCells",e=>this.props.usersWithReactions.filter(Boolean).map((t,i)=>r.createElement(pi,{history:this.props.history,key:t.userId,onUndoPress:this._reactionUndoHandler(t.reactionKey,e),renderUndo:t.isLoggedInUser,user:t,withBottomBorder:i!==this.props.usersWithReactions.length-1}))),a()(this,"_reactionUndoHandler",(e,t)=>()=>{const{conversationId:i,fetchUpdatesIfNeeded:n,createLocalApiErrorHandler:a,entryId:r,loggedInUserId:s,removeReaction:o}=this.props,c={reaction_key:e,conversation_id:i,dm_id:r,perspective:s};t(),o(c).then(this._handleScribeRemoveReaction(e)).then(n).catch(a())}),a()(this,"_handleScribeRemoveReaction",e=>()=>{const{analytics:t}=this.props;t.scribe({page:"app",section:"twitter_service",component:"direct_messages",element:"delete_reaction",action:"success",data:{reaction_emotion:e}})})}render(){const{children:e}=this.props;return r.createElement(bi.a,{renderContent:this._renderContent},e)}}const yi=J.a.create(e=>({cancelButton:{marginHorizontal:e.spaces.xSmall,marginVertical:e.spaces.xSmall},container:{overflowY:"scroll",paddingVertical:e.spaces.xSmall},popover:{maxHeight:"35vh",minWidth:"320px"},sheet:{maxHeight:"65vh"}}));var Ei=Object(hi.a)(Object(Je.a)(ai(_i)));const Ci=je.a.h95f9e76;class Si extends r.PureComponent{constructor(e){super(e),a()(this,"_handleScribeDMReactionSummary",()=>{const{analytics:e}=this.props;e.scribe({component:"dm_reaction_summary",action:"show"})}),a()(this,"_onSetReactionsNode",e=>{this._measureWidths(e||void 0)}),a()(this,"_renderReactions",({isHovered:e})=>{const{reactionsWithCounts:t,selectedReactionKey:i}=this.props,n=this.state.emojiSize||"large",a=t.size-1;return Array.from(t,([t,s],o)=>r.createElement(Ke,{accessible:!0,count:s,emojiSize:n,emotion:t,enableHoverStyle:!1,key:t,style:[o===a&&xi.rightPadding,xi.elementPadding,i===t?xi.selfSelect:null,e&&xi.isHoveredDMReaction]}))}),this.state={emojiSize:void 0}}render(){const{conversationId:e,entryId:t,isEndOfDM:i,isSent:n,totalReactionCount:a}=this.props,{emojiSize:s}=this.state;if(0===a)return null;const o=$.a.generate({backgroundColor:J.a.theme.colors.gray50,color:J.a.theme.colors.gray600}),c=Ci({reactionCount:a});return r.createElement(le.a,{style:[xi.container,i?xi.marginShort:xi.marginLong,n?xi.alignRight:xi.alignLeft,s?xi.visible:xi.invisible]},r.createElement(Ei,{conversationId:e,entryId:t},r.createElement(Z.a,{accessibilityLabel:c,accessible:!0,interactiveStyles:o,onPress:this._handleScribeDMReactionSummary,style:[xi.content],viewRef:this._onSetReactionsNode},this._renderReactions)))}_measureWidths(e){const t=e&&e.parentElement,i={emojiSize:"large"};if(t){const{width:n}=t.getBoundingClientRect(),{width:a=0}=e?e.getBoundingClientRect():{};a>n&&(i.emojiSize="small")}this.setState(Object.assign({},i))}}const xi=J.a.create(e=>({container:{boxSizing:"border-box"},content:{borderRadius:e.borderRadii.infinite,display:"flex",flexDirection:"row"},rightPadding:{paddingRight:e.spaces.micro},elementPadding:{borderColor:e.colors.transparent,borderWidth:e.borderWidths.small,paddingBottom:e.spaces.micro,paddingTop:e.spaces.micro,paddingLeft:`calc(${e.spaces.micro} * 2)`},selfSelect:{borderColor:J.a.theme.colors.gray50,borderRadius:e.borderRadii.infinite},alignLeft:{alignSelf:"flex-start"},alignRight:{alignSelf:"flex-end"},invisible:{opacity:0},visible:{opacity:1},marginShort:{marginBottom:e.spaces.xxSmall},marginLong:{marginBottom:e.spaces.xSmall},isHoveredDMReaction:{borderColor:e.colors.transparent,cursor:"pointer"}}));var Ri=Object(Je.a)(Jt(Si)),Ai=i("Xrkv");const wi=je.a.icd0bf34,Ii=je.a.e8bd8fec,Oi=je.a.b2d32fad,Mi=je.a.a763d33e;class Ti extends r.PureComponent{constructor(e){super(e),a()(this,"_handlePress",e=>{e.stopPropagation(),this.setState({showFullList:!0})}),this.state={showFullList:!1}}render(){const{isGroupDM:e,isSeenByEveryone:t,namesToDisplay:i}=this.props;return r.createElement(le.a,{style:ki.root},r.createElement(de.c,{align:"right",color:"gray600",size:"small",style:ki.seenLabel},this._renderSeenLabel()),!t&&e&&i.length?this._renderNameList():null)}_renderSeenLabel(){const{isGroupDM:e,isSeenByEveryone:t,namesToDisplay:i}=this.props;return t?e?Oi:wi:i.length?Mi({count:i.length}):Ii}_renderNameList(){let{namesToDisplay:e}=this.props;const{showFullList:t}=this.state,i=!t&&e.length>10,n=e.length-10,a=({namesList:e,othersCount:t})=>r.createElement(je.a.I18NFormatMessage,{$i18n:"f6464106"},r.createElement(de.c,null,e),r.createElement(de.c,{color:"link",onPress:this._handlePress},je.a.d7a0722f({othersCount:t})));i&&(e=e.slice(0,10));const s=Object(Ai.a)(e,i);return r.createElement(de.c,{align:"right",color:"gray600",size:"small",style:ki.namesList},i?r.createElement(a,{namesList:s,othersCount:n}):r.createElement(de.c,null,s))}}const ki=J.a.create(e=>({root:{alignItems:"flex-end",width:`calc(100% - ${e.spaces.micro})`},seenLabel:{cursor:"pointer"},namesList:{marginBottom:e.spaces.micro,whiteSpace:"pre-line"}}));var Li=Ti,Di=i("t0aI");const Fi=({entryId:e,participants:t,user:i})=>{const n=Object.keys(t),a=Pi({entryId:e,participants:t,user:i});return{namesToDisplay:a,isSeenByEveryone:a.length===n.length-1}},Pi=({entryId:e,participants:t,user:i})=>Object.keys(t).reduce((n,a)=>{const{join_conversation_event_id:r,last_read_event_id:s,user:{name:o}}=t[a],c=a!==i.id_str,l=s&&1!==Object(Di.a)(e,s),d=!r||1!==Object(Di.a)(r,e);return c&&l&&d&&n.push(o),n},[]);var ji=i("IMYl"),Bi=i("21zW"),Ni=i("gmpV");const Ui=je.a.fad48ee9,Wi=je.a.ba60339a,Hi=je.a.d338f53e,zi=je.a.ae7d7a24,Vi=je.a.d725a288,qi=je.a.bbe74f3f,Gi=je.a.h0e4cdf4,Qi=je.a.bfbc051c;class Yi extends r.PureComponent{constructor(...e){super(...e),a()(this,"_handleRemove",()=>{const{conversationId:e,removeEntry:t,entryId:i}=this.props;t(e,null,{id:i})}),a()(this,"_handleTryAgain",()=>{const{sendMessage:e,conversationId:t,localMediaId:i,entryText:n,user:a}=this.props;e({senderId:a.id_str,conversationId:t,text:n,localMediaId:i}),this._handleRemove()})}render(){const{isSent:e,onPress:t}=this.props,i=this._renderSending(),n=this._renderError(),a=this._renderTimestamp(),s=this._renderReadReceipt(),o=this._renderSentCheckmark(),c=this._renderReactions(),l=a||s||o;return(i||n||c||l)&&r.createElement(le.a,{style:[Ki.root,e&&Ki.sentMessage]},i,n,c,l?r.createElement(Z.a,{interactiveStyles:null,onPress:t,style:e&&Ki.sentContainer},r.createElement(le.a,{style:e&&Ki.groupedItems},a,o),s):null)}_renderError(){const{isError:e}=this.props;return e&&r.createElement(le.a,null,r.createElement(de.c,{align:"right",color:"gray600",size:"small"},zi),r.createElement(le.a,{style:Ki.groupedItems},r.createElement(de.c,{accessibilityRole:"button",color:"red500",onPress:this._handleRemove,size:"small",withInteractiveStyling:!0},Wi),r.createElement(Bi.a,null),r.createElement(de.c,{accessibilityRole:"button",color:"primary",onPress:this._handleTryAgain,size:"small",withInteractiveStyling:!0},Hi)))}_renderReactions(){const{conversationId:e,entryId:t,isLastRapidFire:i,isRapidFire:n,isSent:a}=this.props,s=!n||i;return r.createElement(le.a,{style:!a&&Ki.footerPadderWithAvatar},r.createElement(Ri,{conversationId:e,entryId:t,isEndOfDM:s,isSent:a}))}_renderReadReceipt(){const{entryId:e,isActive:t,isDraft:i,isError:n,isGroupDM:a,isSent:s,participants:o,user:c}=this.props;return t&&s&&!i&&!n?r.createElement(Li,zt()({isGroupDM:a},Fi({entryId:e,participants:o,user:c}))):null}_renderSending(){const{isDraft:e,isError:t}=this.props;return e&&!t&&r.createElement(de.c,{align:"right",color:"gray600",size:"small"},Ui)}_renderSentCheckmark(){const{entryId:e,isDraft:t,isError:i,isLastRapidFire:n,isRapidFire:a,isSent:s,participants:o,user:c}=this.props,{isSeenByEveryone:l}=Fi({entryId:e,participants:o,user:c});return!s||t||i||a&&!n?null:r.createElement(de.c,{color:l?"primary":"gray600",style:Ki.checkmarkContainer},r.createElement(ji.a,{style:Ki.checkmark}))}_renderTimestamp(){const{entryTime:e,isDraft:t,isGroupDM:i,isError:n,isLastRapidFire:a,isRapidFire:s,isSent:o,user:{name:c}}=this.props;if(t||n||s&&!a)return null;const l=new Date(Number(e));let d;d=Object(Ni.b)(l)?Vi(l):Object(Ni.c)(l)?qi({time:Vi(l)}):Object(Ni.d)(l)?Gi(l):Qi(l);const u=i&&!o,p=o?"right":"left",h=!o;return r.createElement(le.a,{style:[h&&Ki.footerPadderWithAvatar,o&&Ki.timestamp]},r.createElement(de.c,{align:p,color:"gray600",size:"small",withInteractiveStyling:o||!dt.a.isEnabled},u&&r.createElement(je.a.I18NFormatMessage,{$i18n:"c8b914d4"},r.createElement(de.c,null,c)),u&&" ",d))}}const Ki=J.a.create(e=>({root:{marginTop:e.spaces.micro,overflow:"hidden",width:"87.5%"},sentMessage:{alignSelf:"flex-end",justifyContent:"flex-end"},sentContainer:{flexDirection:"column"},groupedItems:{justifyContent:"flex-end",flexDirection:"row"},timestamp:{cursor:"pointer"},checkmark:{cursor:"pointer",flexShrink:0,height:"1rem",paddingLeft:e.spaces.micro},checkmarkContainer:{lineHeight:"1"},footerPadderWithAvatar:{marginLeft:`calc(${e.spaces.xLarge} + ${e.spaces.xSmall})`}}));var $i=Object(M.c)()(Gt(Yi)),Ji=i("jtO7");const Xi=J.a.create(e=>({root:{borderColor:e.colors.gray50,borderStyle:"solid",borderWidth:e.borderWidths.small,borderBottomWidth:e.borderWidths.none,boxSizing:"border-box",overflow:"hidden"},isLast:{borderBottomWidth:e.borderWidths.small},insideTopRoundedSent:{borderTopLeftRadius:e.borderRadii.xLarge},insideTopRoundedReceived:{borderTopRightRadius:e.borderRadii.xLarge},outsideTopRoundedSent:{borderTopRightRadius:e.borderRadii.xLarge},outsideTopRoundedReceived:{borderTopLeftRadius:e.borderRadii.xLarge},sentLast:{borderBottomLeftRadius:e.borderRadii.xLarge},receivedLast:{borderBottomRightRadius:e.borderRadii.xLarge}}));var Zi=({insideTopRounded:e,isSent:t,isLast:i,label:n,onClick:a,tcoUrl:s,outsideTopRounded:o})=>{const c=[Xi.root,i&&Xi.isLast,i&&t&&Xi.sentLast,i&&!t&&Xi.receivedLast,e&&t&&Xi.insideTopRoundedSent,e&&!t&&Xi.insideTopRoundedReceived,o&&t&&Xi.outsideTopRoundedSent,o&&!t&&Xi.outsideTopRoundedReceived];return r.createElement(le.a,{style:c},r.createElement(Ji.a,{align:"center",color:"primary",label:n,link:s,onClick:a,withBottomBorder:!1}))},en=i("fs1G");class tn extends r.Component{componentDidMount(){this.props.onImpression()}render(){const{callToActions:e,isSent:t,onCtaClick:i,withSticker:n,withUserText:a}=this.props,s=e.map((s,o)=>{const c=0===o;return r.createElement(Zi,{insideTopRounded:c&&(n||!a),isLast:o===e.length-1,isSent:t,key:o,label:s.label,onClick:i,outsideTopRounded:c&&n,tcoUrl:s.tco_url})});return r.createElement(le.a,null,s)}}a()(tn,"defaultProps",{onCtaClick:en.a,onImpression:en.a});var nn=tn,an=i("vjRr");const rn=Object(m.createSelector)((e,t)=>an.a.createManyHydratedSelector([t.cardUrl])(e)[0],e=>({card:e})),sn={popOutConversation:c.popOutConversation};var on=Object(p.g)(rn,sn);const cn=J.a.create(e=>({root:{width:"100%"},invisible:{opacity:0},visible:{opacity:1}}));var ln=({attachmentContent:e,attachmentHeader:t,isVisible:i=!0,textContent:n})=>r.createElement(le.a,{style:[i?cn.visible:cn.invisible,cn.root]},t,e,n),dn=i("cTG8");const un=({excludeCardUrl:e,isActive:t=!1,isFailedDraft:i,isFirstRapidFire:n=!1,isRapidFire:a=!1,isSent:s,hasAssociatedAttachment:o,messageData:c={},rootStyle:l,tweetId:d,withCta:u,withMediaLinks:p,withMessageBubble:h})=>{const m=[l,h&&pn.messageTextContainer,h&&s&&pn.sent,h&&!s&&pn.received,i&&pn.failedDraft,a&&!n&&!s&&pn.rapidFireReceived,a&&!n&&s&&pn.rapidFireSent,o&&s&&pn.hasAssociatedAttachmentSent,o&&!s&&pn.hasAssociatedAttachmentReceived,h&&t&&s&&pn.activeSent,h&&t&&!s&&!dt.a.isEnabled&&pn.activeReceived,u&&pn.withCta],b=[pn.tweetText,h&&pn.textAlignLeft,!h&&s&&pn.textAlignRight],{white:g,text:v,primary:f,gray0:_,red500:y}=J.a.theme.colors,E=$.a.generate({color:s?g:v,backgroundColor:i?y:s?f:_}),C=c.text&&c.text.length||0;return r.createElement(Z.a,{accessibilityRole:"none",interactive:s,interactiveStyles:h?E:null,style:m},r.createElement(dn.a,{color:J.a.isDarkMode()||s?"whiteOnColor":void 0,displayTextRange:[0,C],entities:c.entities,excludeCardUrl:e,linkColor:h&&s||J.a.isDarkMode()?"whiteOnColor":"link",linkify:!0,quotedTweetId:d,size:h?void 0:"jumbo",style:b,text:c.text||"",underlineLinks:!0,withMediaLinks:p}))},pn=J.a.create(e=>({tweetText:{overflow:"hidden"},messageTextContainer:{borderRadius:e.borderRadii.xLarge,boxSizing:"border-box",maxWidth:"100%",paddingVertical:e.spaces.xSmall,paddingHorizontal:e.spaces.small},textAlignLeft:{textAlign:"left"},textAlignRight:{textAlign:"right"},sent:{alignSelf:"flex-end",backgroundColor:e.colors.primary,borderBottomRightRadius:e.borderRadii.none,borderColor:e.colors.primary},received:{alignSelf:"flex-start",backgroundColor:e.colors.dmReceivedBubbleBackground,borderBottomLeftRadius:e.borderRadii.none,borderColor:e.colors.gray200},activeSent:{backgroundColor:e.colors.lightPrimary},activeReceived:{backgroundColor:e.colors.gray200},failedDraft:{backgroundColor:e.colors.red500},rapidFireReceived:{borderTopLeftRadius:e.borderRadii.none},rapidFireSent:{borderTopRightRadius:e.borderRadii.none},withCta:{borderBottomRightRadius:e.borderRadii.none,borderBottomLeftRadius:e.borderRadii.none},hasAssociatedAttachmentSent:{borderTopRightRadius:e.borderRadii.none},hasAssociatedAttachmentReceived:{borderTopLeftRadius:e.borderRadii.none}}));un.defaultProps={withMediaLinks:!1};var hn=un,mn=i("NnR4");class bn extends r.Component{constructor(...e){super(...e),a()(this,"state",{attachmentWidth:void 0,textContentWidth:void 0}),a()(this,"_handleAttachmentLayout",e=>{const{nativeEvent:{layout:{width:t}}}=e,{attachmentWidth:i}=this.state;if(i!==t){const e={attachmentWidth:t};this.setState(e)}}),a()(this,"_handlePopOutDM",()=>{const{conversationId:e,popOutConversation:t}=this.props;e&&t(e)}),a()(this,"_handleTextContentLayout",e=>{const{nativeEvent:{layout:{width:t}}}=e,{textContentWidth:i}=this.state;if(i!==t){const e={textContentWidth:t};this.setState(e)}})}render(){const{card:e,hasUserText:t,isActive:i,isFailedDraft:n,isFirstRapidFire:a,isRapidFire:s,isSent:o,messageData:c,withCta:l,withMessageBubble:d}=this.props,{attachmentWidth:u,textContentWidth:p}=this.state,h=ft(t,u,p),m=h.isAttachmentSquared?"both":o?"right":"left",b=r.createElement(le.a,{onClick:this._handlePopOutDM,onLayout:this._handleAttachmentLayout},r.createElement(mn.a,{card:{name:e.name,url:e.url,binding_values:e.binding_values,users:e.users},cardContext:{tweetUserId:c.sender_id},dmSentOrReceived:o?"sent":"received",withSquareBottomBorderRadius:m})),g=t?r.createElement(le.a,{onLayout:this._handleTextContentLayout,style:o?gn.sentMessageWrapper:gn.receivedMessageWrapper},r.createElement(hn,{excludeCardUrl:e.url,hasAssociatedAttachment:!0,isActive:i,isFailedDraft:n,isFirstRapidFire:a,isRapidFire:s,isSent:o,messageData:c,rootStyle:h.isTextSquared?o?gn.textSentSquared:gn.textReceivedSquared:void 0,withCta:l,withMessageBubble:d})):null;return r.createElement(ln,{attachmentContent:b,isVisible:h.compositeRendered,textContent:g})}}a()(bn,"defaultProps",{hasUserText:!1});const gn=J.a.create(e=>({attachmentReceivedSquared:{borderBottomRightRadius:e.borderRadii.none},attachmentSentSquared:{borderBottomLeftRadius:e.borderRadii.none},card:{marginBottom:e.spaces.micro},receivedMessageWrapper:{alignSelf:"flex-start"},sentMessageWrapper:{alignSelf:"flex-end"},received:{borderBottomLeftRadius:e.borderRadii.none},sent:{borderBottomRightRadius:e.borderRadii.none},textReceivedSquared:{borderTopRightRadius:e.borderRadii.none},textSentSquared:{borderTopLeftRadius:e.borderRadii.none}}));var vn=on(bn),fn=i("cSHO"),_n=i("rxPX"),yn=i("wJQ9");const En=e=>{const{message_data:t}=e;if(t){const{time:e}=t;return(new Date).getTime()-parseInt(e,10)>864e5}return!0},Cn=(e,t)=>fn.b(e,t.fleetId),Sn=(e,t)=>t.messageData.recipient_id?y.e.select(e,t.messageData.recipient_id):void 0,xn=(e,t)=>{const i=fn.c(e,t.fleetId),n=t.messageData.recipient_id?fn.f(e,t.messageData.recipient_id):void 0,a=En(t.entry);return a||n===b.a.LOADED&&(i===b.a.NONE||i===b.a.FAILED)?yn.a.EXPIRED:a||i!==b.a.NONE?i:yn.a.LOADING},Rn=(e,t)=>fn.d(e,t.fleetId);var An=Object(_n.a)().propsFromState(()=>({fleet:Cn,fleetUser:Sn,fleetFetchStatus:xn,isInterstitialed:Rn})).propsFromActions(()=>({createLocalApiErrorHandler:Object(h.d)("DM_FLEET_MESSAGE"),fetchUserFleetsIfNeeded:fn.a,updateFleetIsInterstitialed:fn.g})).withAnalytics({page:"messages",section:"fleet"}),wn=i("prG5"),In=i("Q+Pg"),On=i("9Xij"),Mn=i("Qwev"),Tn=i("A91F");const kn=je.a.f720438f,Ln=je.a.cc1030a5,Dn=je.a.b327c129;function Fn(e){var t;const{fleet:i,fleetFetchStatus:n}=e,a=null==i||null==(t=i.media_entity)?void 0:t.media_url_https,[s,o]=r.useState(n!==yn.a.EXPIRED);r.useEffect(()=>{if(s){const e=setTimeout(()=>o(!1),500);return()=>clearTimeout(e)}},[s]);const c=k.b.isTrue("responsive_web_fleets_dm_consumption_enabled"),l=c?kn:Ln;if(c&&n===yn.a.LOADING)return(e=>r.createElement(le.a,{style:Pn.loadingIndicatorWrapper},r.createElement(On.a,{ratio:9/16},r.createElement(le.a,{style:Pn.activityIndicatorWrapper},e?void 0:r.createElement(Mn.a,null)))))(s);if(c&&i&&i.media_entity&&a){const e=Object(In.d)(yn.c.Original,i.media_entity);return r.createElement(wn.a,{accessibilityLabel:Dn,aspectMode:Tn.a.withinRange(9/16,10),image:{url:a,width:e.width,height:e.height}})}return r.createElement(de.c,{color:"gray600"},l)}const Pn=J.a.create(e=>({loadingIndicatorWrapper:{backgroundColor:e.colors.gray0,borderColor:e.colors.gray50},activityIndicatorWrapper:{height:"100%",justifyContent:"center",alignItems:"center"}})),jn=je.a.d9e524a7,Bn=je.a.b3d08517,Nn=je.a.ab1dd773,Un=je.a.f483af99;class Wn extends r.Component{constructor(...e){super(...e),a()(this,"_fleetsDMConsumptionEnabled",k.b.isTrue("responsive_web_fleets_dm_consumption_enabled")),a()(this,"_fleetsViewerScreenEnabled",k.b.isTrue("responsive_web_fleets_viewer_screen_enabled")),a()(this,"state",{attachmentWidth:void 0,textContentWidth:void 0}),a()(this,"_getSquareBottomStyles",e=>{const{isSent:t}=this.props;let i="left";return e?i="both":t&&(i="right"),Hn[i]}),a()(this,"_handleAttachmentLayout",e=>{const{nativeEvent:{layout:{width:t}}}=e,{attachmentWidth:i}=this.state;i!==t&&this.setState({attachmentWidth:t})}),a()(this,"_handleTextContentLayout",e=>{const{nativeEvent:{layout:{width:t}}}=e,{textContentWidth:i}=this.state;i!==t&&this.setState({textContentWidth:t})}),a()(this,"_renderFleet",e=>{var t;const{fleet:i,fleetFetchStatus:n,fleetUser:a,isSent:s}=this.props,o=!!(null==i||null==(t=i.media_entity)?void 0:t.media_url_https)||n===yn.a.LOADING,c=o&&this._fleetsDMConsumptionEnabled&&this._fleetsViewerScreenEnabled&&i&&a&&(null==a?void 0:a.screen_name)&&(null==i?void 0:i.fleet_id)?(l=a.screen_name,d=i.fleet_id,`/${l}/fleets/${d}`):void 0;var l,d;const u=[this._fleetsDMConsumptionEnabled&&o?zn.fleetWrapper:zn.tombstoneWrapper,s?zn.sentMessageWrapper:zn.receivedMessageWrapper,this._getSquareBottomStyles(e)];return r.createElement(Z.a,{interactiveStyles:null,link:c,onClick:c?this._handleClick:void 0,onLayout:this._handleAttachmentLayout,style:u},r.createElement(Fn,{fleet:i,fleetFetchStatus:n}))}),a()(this,"_renderFleetAttachmentHeader",()=>{const{isSent:e,withMessageBubble:t}=this.props;let i;return i=e&&t?Un:t?Nn:e?Bn:jn,r.createElement(de.c,{color:"gray600",size:"small",style:[zn.attachmentHeader,e?zn.sentMessageWrapper:zn.receivedMessageWrapper]},i)}),a()(this,"_renderFleetTextContent",e=>{const{hasUserText:t,isActive:i,isFailedDraft:n,isFirstRapidFire:a,isRapidFire:s,isSent:o,messageData:c,withCta:l,withMessageBubble:d}=this.props;return t?r.createElement(le.a,{onLayout:this._handleTextContentLayout,style:o?zn.sentMessageWrapper:zn.receivedMessageWrapper},r.createElement(hn,{hasAssociatedAttachment:!0,isActive:i,isFailedDraft:n,isFirstRapidFire:a,isRapidFire:s,isSent:o,messageData:c,rootStyle:e?o?zn.sentSquared:zn.receivedSquared:void 0,withCta:l,withMessageBubble:d})):null})}componentDidMount(){const{analytics:e,createLocalApiErrorHandler:t,messageData:i,fleetFetchStatus:n,fleetId:a,fetchUserFleetsIfNeeded:r}=this.props;e.scribe({element:"fleets_attachment_tombstone",action:"impression"}),this._fleetsDMConsumptionEnabled&&n!==yn.a.EXPIRED&&i.recipient_id&&r(i.recipient_id,a).catch(t())}componentDidUpdate(e){const{fleet:t,onIsFleetAvailable:i}=this.props;if(this._fleetsDMConsumptionEnabled&&!Object(ce.a)(t,e.fleet)){i(!!t)}}render(){const{hasUserText:e,messageData:t}=this.props,{attachmentWidth:i,textContentWidth:n}=this.state;if(!t||!t.attachment||!t.attachment.fleet)return null;const{compositeRendered:a,isAttachmentSquared:s,isTextSquared:o}=ft(e,i,n);return r.createElement(ln,{attachmentContent:this._renderFleet(s),attachmentHeader:this._fleetsDMConsumptionEnabled?this._renderFleetAttachmentHeader():void 0,isVisible:a,textContent:this._renderFleetTextContent(o)})}_handleClick(e){e.stopPropagation()}}const Hn=J.a.create(e=>({both:{borderBottomRightRadius:e.borderRadii.none,borderBottomLeftRadius:e.borderRadii.none},left:{borderBottomLeftRadius:e.borderRadii.none},right:{borderBottomRightRadius:e.borderRadii.none}})),zn=J.a.create(e=>({attachmentHeader:{marginBottom:e.spaces.xxSmall},isSent:{borderBottomRightRadius:e.borderRadii.none},fleetWrapper:{borderRadius:e.borderRadii.xLarge,WebkitMaskImage:"url(data:image/png;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICRAEAOw==)",width:"100%"},received:{borderBottomLeftRadius:e.borderRadii.none},receivedMessageWrapper:{alignSelf:"flex-start"},receivedSquared:{borderTopRightRadius:e.borderRadii.none},sentMessageWrapper:{alignSelf:"flex-end"},sentSquared:{borderTopLeftRadius:e.borderRadii.none},tombstoneWrapper:{backgroundColor:e.colors.gray0,borderColor:e.colors.gray50,borderRadius:e.borderRadii.xLarge,boxSizing:"border-box",flexDirection:"row",borderWidth:e.borderWidths.small,paddingHorizontal:e.spaces.small,paddingVertical:e.spaces.xSmall,overflow:"auto"}}));var Vn=An(Wn),qn=i("RCZO");const Gn=je.a.b327c129,Qn=e=>{e.stopPropagation()};var Yn=({media:e,mediaUrl:t})=>{const i=e.ext_alt_text||Gn,n=e.media_url_https,{width:a,height:s}=e.original_info||{},o=Object(qn.c)(e).rgb,c=r.createElement(wn.a,{accessibilityLabel:i,aspectMode:Tn.a.withinRange(9/16,10),backgroundColor:o,image:{url:n,width:a,height:s},shouldShowAltLabel:!!e.ext_alt_text});return t?r.createElement(Z.a,{interactiveStyles:null,link:t,onPress:Qn},c):c},Kn=i("Modb"),$n=i("lklz"),Jn=i("XrEN"),Xn=i("ZvMt");var Zn=({media:e,messageId:t})=>{const i=e&&Jn.a.extractVideoProps($n.b.forDm(t),e);return i?r.createElement(Kn.a,zt()({},i,{aspectRatio:Xn.a.getAspectRatio(e.video_info),withPostPlayback:!0})):null};const ea={scribeAction:o.c};var ta=Object(p.b)(ea),ia=i("cHvH");class na extends r.PureComponent{constructor(e,t){super(e,t),a()(this,"_getElement",()=>{const{isSensitive:e,contentType:t}=this.props;return`${e?"sensitive":"untrusted"}_${t}_interstitial`}),a()(this,"_handleClick",()=>{const{scribeAction:e,scribeNamespace:t}=this.props;this.setState({hide:!1}),e(Object.assign({},t,{element:this._getElement(),action:"reveal"}))}),this.state={hide:!0}}componentDidMount(){const{scribeAction:e,scribeNamespace:t}=this.props;e(Object.assign({},t,{element:this._getElement(),action:"impression"}))}render(){const{children:e,ctaText:t,description:i,withSquareBottomBorderRadius:n}=this.props;return this.state.hide?r.createElement(ia.a,null,({windowWidth:e})=>{const a=e<J.a.theme.breakpoints.medium;return r.createElement(le.a,{accessible:!0,style:[ra.root,a?{flexDirection:"column"}:{flexDirection:"row",alignItems:"center"},n&&aa[n]]},r.createElement(le.a,{style:ra.description},r.createElement(de.c,null,i)),r.createElement(le.a,{style:[ra.button,a?ra.breakButtonWrapper:void 0]},r.createElement(lt.a,{onClick:this._handleClick,size:"normalCompact",style:ra.buttonElement,type:"text"},t)))}):e}}a()(na,"defaultProps",{isSensitive:!1});const aa=J.a.create(e=>({both:{borderBottomRightRadius:e.borderRadii.none,borderBottomLeftRadius:e.borderRadii.none},left:{borderBottomLeftRadius:e.borderRadii.none},right:{borderBottomRightRadius:e.borderRadii.none}})),ra=J.a.create(e=>({breakButtonWrapper:{marginTop:J.a.theme.spaces.xxSmall,marginLeft:`calc(-1 * ${e.spaces.xSmall})`},button:{flexGrow:1,alignItems:"flex-start"},buttonElement:{paddingHorizontal:e.spaces.xSmall},description:{flexGrow:1,flexShrink:1},root:{backgroundColor:e.colors.gray0,borderBottomLeftRadius:e.borderRadii.none,borderColor:e.colors.gray50,borderRadius:e.borderRadii.xLarge,boxSizing:"border-box",borderWidth:e.borderWidths.small,maxWidth:"100%",paddingLeft:e.spaces.small,paddingTop:e.spaces.small,paddingBottom:e.spaces.small,paddingRight:e.spaces.xxSmall,overflow:"auto",display:"flex"}}));var sa=Object(M.c)()(ta(na)),oa=i("M7Ix");const ca=r.createElement(oa.a,null),la=je.a.d9de7b57,da=je.a.f2879f4d,ua=je.a.b518221e,pa=je.a.eeaa9f90,ha=je.a.g2b43663,ma=je.a.f277e949;class ba extends r.Component{constructor(...e){super(...e),a()(this,"state",{attachmentWidth:void 0,textContentWidth:void 0}),a()(this,"_renderAttachment",()=>{const{entry:e,hasUserText:t,isFirstRapidFire:i,isRapidFire:n,isSent:a,isTrusted:s,messageData:o}=this.props,{attachmentWidth:c,textContentWidth:l}=this.state,{attachment:d}=o||{},u=e.is_draft,p=ft(t,c,l),h=[ga.mediaAttachment,a&&ga.isSent,!a&&ga.received,a&&p.isAttachmentSquared&&ga.equalComponentDimensionsSent,!a&&p.isAttachmentSquared&&ga.equalComponentDimensionsReceived,n&&!i&&a&&ga.rapidFireSent,n&&!i&&!a&&ga.rapidFireReceived];let m,b,g=null;if(!u&&e.conversation_id&&(g=`/messages/${e.conversation_id}/media/${e.id}`),d)if(d.photo)m=d.photo,b=r.createElement(Yn,{media:m,mediaUrl:g});else if(d.animated_gif)m=d.animated_gif,b=r.createElement(Zn,{media:m,messageId:e.id});else if(d.video){if(m=d.video,Object(C.b)(d,this.context.featureSwitches))throw new Error("DMMediaMessage should not be used to render voice messages");b=r.createElement(Zn,{media:m,messageId:e.id})}const v=p.isAttachmentSquared?"both":a?"right":"left",f=m&&b&&(a?b:this._getMediaContentWithGuard(m,s,b,v));return{attachmentContent:r.createElement(le.a,{onLayout:this._handleAttachmentLayout,style:h},f),media:m}}),a()(this,"_handleAttachmentLayout",e=>{const{nativeEvent:{layout:{width:t}}}=e,{attachmentWidth:i}=this.state;if(i!==t){const e={attachmentWidth:t};this.setState(e)}}),a()(this,"_handleTextContentLayout",e=>{const{nativeEvent:{layout:{width:t}}}=e,{textContentWidth:i}=this.state;if(i!==t){const e={textContentWidth:t};this.setState(e)}})}render(){const{entry:e,hasUserText:t,isActive:i,isFailedDraft:n,isFirstRapidFire:a,isRapidFire:s,isSent:o,messageData:c,withCta:l,withMessageBubble:d}=this.props,{attachmentWidth:u,textContentWidth:p}=this.state,h=e.is_draft,m=ft(t,u,p),{media:b,attachmentContent:g}=this._renderAttachment(),v=t?r.createElement(le.a,{onLayout:this._handleTextContentLayout,style:o?ga.sentMessageWrapper:ga.receivedMessageWrapper},r.createElement(hn,{hasAssociatedAttachment:!0,isActive:!!i,isFailedDraft:n,isFirstRapidFire:!!a,isRapidFire:!!s,isSent:o,messageData:h?c:this._parseMessageData(c,b),rootStyle:m.isTextSquared?o?ga.sentSquared:ga.receivedSquared:void 0,withCta:l,withMessageBubble:d})):null;return r.createElement(ln,{attachmentContent:g,isVisible:m.compositeRendered,textContent:v})}_getMediaContentWithGuard(e,t,i,n){const{displaySensitiveMedia:a,isDmNsfwMediaFilterEnabled:s}=this.props;if(!e.possibly_sensitive||!this.context.featureSwitches.isTrue("dm_conversations_nsfw_media_filter_enabled"))return!a&&e.possibly_sensitive?r.createElement(sa,{contentType:e.type,ctaText:ma,description:ca,isSensitive:!0,withSquareBottomBorderRadius:n},i):t?i:r.createElement(sa,{contentType:e.type,ctaText:ma,description:la,withSquareBottomBorderRadius:n},i);if(s){const t="animated_gif"===e.type&&ha||"video"===e.type&&pa||ua;return r.createElement(sa,{contentType:e.type,ctaText:t,description:da,isSensitive:!0,withSquareBottomBorderRadius:n},i)}}_parseMessageData(e,t){const i=e&&e.entities&&e.entities.urls&&t?e.entities.urls.filter(e=>e.display_url!==t.display_url):null;return e&&i?Object.assign({},e,{entities:Object.assign({},e.entities,{urls:i,media:[t]})}):void 0}}a()(ba,"contextType",Q.a),a()(ba,"defaultProps",{hasUserText:!1});const ga=J.a.create(e=>({equalComponentDimensionsSent:{borderBottomLeftRadius:e.borderRadii.none},equalComponentDimensionsReceived:{borderBottomRightRadius:e.borderRadii.none},invisible:{opacity:0},isSent:{borderBottomRightRadius:e.borderRadii.none},mediaAttachment:{borderRadius:e.borderRadii.xLarge,WebkitMaskImage:"url(data:image/png;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICRAEAOw==)"},receivedMessageWrapper:{alignSelf:"flex-start"},sentMessageWrapper:{alignSelf:"flex-end"},rapidFireReceived:{borderTopLeftRadius:e.borderRadii.none},rapidFireSent:{borderTopRightRadius:e.borderRadii.none},received:{borderBottomLeftRadius:e.borderRadii.none},receivedSquared:{borderTopRightRadius:e.borderRadii.none},sentSquared:{borderTopLeftRadius:e.borderRadii.none},visible:{opacity:1}}));var va=ba,fa=Object(_n.a)().propsFromActions(()=>({markSpamStatus:c.markSpamStatus}));const _a=je.a.fd07947f,ya=je.a.c7a92dc9,Ea=je.a.f277e949,Ca=je.a.fb3ccb55;class Sa extends r.PureComponent{constructor(...e){super(...e),a()(this,"_handlePress",e=>()=>{const{conversationId:t,dmId:i,markSpamStatus:n}=this.props;n({conversationId:t,dmId:i,markSpam:e})})}render(){const{children:e}=this.props;return r.createElement(sa,{contentType:"dm",ctaText:Ea,description:Ca},e,this._renderButtons())}_renderButtons(){return r.createElement(le.a,{style:Ra.buttons},r.createElement(lt.a,{onPress:this._handlePress(!1),style:Ra.leftButton,type:"secondary"},ya),r.createElement(lt.a,{onPress:this._handlePress(!0),type:"secondary"},_a))}}var xa=fa(Sa);const Ra=J.a.create(e=>({buttons:{flexDirection:"row",paddingTop:e.spaces.xxSmall},leftButton:{marginRight:e.spaces.xSmall}}));var Aa=({isActive:e=!1,isFailedDraft:t,isFirstRapidFire:i=!1,isRapidFire:n=!1,isSent:a,messageData:s,withCta:o,withMessageBubble:c})=>r.createElement(hn,{isActive:e,isFailedDraft:t,isFirstRapidFire:i,isRapidFire:n,isSent:a,messageData:s,withCta:o,withMediaLinks:!0,withMessageBubble:c}),wa=i("U+bB");const Ia=e=>{const t=e.images,i=t.svg||t.size_1x;if(i)return i.url},Oa=J.a.create(e=>({stickerItem:{height:`calc(3 * ${e.fontSizes.jumbo})`,width:`calc(3 * ${e.fontSizes.jumbo})`}}));var Ma=({sticker:e})=>r.createElement(wa.a,{accessibilityLabel:e.display_name,source:Ia(e),style:Oa.stickerItem}),Ta=Object(_n.a)().propsFromActions(()=>({popOutConversation:c.popOutConversation})),ka=i("b5s6");const La=je.a.e4df0ad7,Da=je.a.f277e949;class Fa extends r.Component{constructor(...e){super(...e),a()(this,"state",{attachmentWidth:void 0,textContentWidth:void 0}),a()(this,"_handleAttachmentLayout",e=>{const{nativeEvent:{layout:{width:t}}}=e,{attachmentWidth:i}=this.state;if(i!==t){const e={attachmentWidth:t};this.setState(e)}}),a()(this,"_handleTextContentLayout",e=>{const{nativeEvent:{layout:{width:t}}}=e,{textContentWidth:i}=this.state;if(i!==t){const e={textContentWidth:t};this.setState(e)}}),a()(this,"_handlePopOutDM",()=>{const{conversationId:e,popOutConversation:t}=this.props;e&&t(e)})}render(){const{hasUserText:e=!1,isActive:t=!1,isFailedDraft:i,isFirstRapidFire:n=!1,isRapidFire:a=!1,isSent:s,isTrusted:o,messageData:c,withCta:l,withMessageBubble:d}=this.props,{attachmentWidth:u,textContentWidth:p}=this.state;if(!c||!c.attachment||!c.attachment.tweet)return null;const h=c.attachment.tweet,m=s?"sent":"received",b=ft(e,u,p),g=r.createElement(ka.a,{onPress:k.b.isTrue("responsive_web_dm_quick_access_enabled")?this._handlePopOutDM:void 0,style:[Pa[m],e&&Pa.attachment,b.isAttachmentSquared?s?Pa.sentAttachmentSquared:Pa.receivedAttachmentSquared:void 0],tweetId:h.status}),v=b.isAttachmentSquared?"both":s?"right":"left",f=o?g:r.createElement(sa,{contentType:"tweet",ctaText:Da,description:La,withSquareBottomBorderRadius:v},g),_=r.createElement(le.a,{onLayout:this._handleAttachmentLayout,style:Pa.attachment},f),y=e?r.createElement(le.a,{onLayout:this._handleTextContentLayout,style:s?Pa.sentMessageWrapper:Pa.receivedMessageWrapper},r.createElement(hn,{hasAssociatedAttachment:!0,isActive:t,isFailedDraft:i,isFirstRapidFire:n,isRapidFire:a,isSent:s,messageData:c,rootStyle:b.isTextSquared?s?Pa.sentSquared:Pa.receivedSquared:void 0,tweetId:h.status,withCta:l,withMediaLinks:!0,withMessageBubble:d})):null;return r.createElement(ln,{attachmentContent:_,isVisible:b.compositeRendered,textContent:y})}}const Pa=J.a.create(e=>({attachment:{marginBottom:0},receivedMessageWrapper:{alignSelf:"flex-start"},sentMessageWrapper:{alignSelf:"flex-end"},received:{borderBottomLeftRadius:e.borderRadii.none,borderColor:e.colors.gray200},receivedAttachmentSquared:{borderBottomRightRadius:e.borderRadii.none},receivedSquared:{borderTopRightRadius:e.borderRadii.none},sent:{borderBottomRightRadius:e.borderRadii.none,borderColor:e.colors.primary},sentAttachmentSquared:{borderBottomLeftRadius:e.borderRadii.none},sentSquared:{borderTopLeftRadius:e.borderRadii.none}}));var ja=Ta(Fa),Ba=i("zb92"),Na=Object(Ba.a)({loader:()=>Promise.all([i.e(19),i.e(135)]).then(i.bind(null,"PEyh")).then(e=>({default:e.__DANGEROUS_IMPORT_VIDEOPLAYER__}))});function Ua(){const e=r.useContext(Ka),[t,i]=e.activeVoiceMessage,[,n]=e.playerApi,[,a]=e.playerState,[,s]=t;const o={media:s,onEnded:function(){i([null,null]),e.scribeAction&&e.scribeAction.complete()},onPlayerApi:n,onPlayerState:a};return r.createElement(Na,o)}var Wa=i("k89r");function Ha(e){const t=function(){const e=r.useState(qa.activeVoiceMessage),t=r.useState(qa.playerApi),i=r.useState(qa.playerState),n=function(){const e=Object(Wa.a)();return r.useMemo(()=>{const t={page:"messages",section:"thread",component:"message",element:"voice"};function i({action:e,component:i=t.component}){const{page:n,section:a,element:r}=t;return{page:n,section:a,component:i,element:r,action:e}}const n=(t,n)=>n?n.data?e.scribe(Object.assign({},i({action:t}),{data:n.data})):e.scribe(Object.assign({},i({action:t,component:Va(n)}))):e.scribe(Object.assign({},i({action:t})));return{impression:e=>n("impression",e),report:e=>n("report",e),play:e=>n("play",e),pause:()=>n("pause"),complete:()=>n("complete")}},[e])}();return{activeVoiceMessage:e,playerApi:t,playerState:i,scribeAction:n}}();return r.createElement(Ga.Provider,{value:t},e.children)}const za={Timelines:function(e){const t={};return Object.keys(e).forEach(e=>{t[e]=e}),Object.freeze(t)}({message:!0,inbox_timeline:!0,low_quality_timeline:!0,requests_timeline:!0})};function Va({isLowQuality:e,isTrusted:t}){return t?za.Timelines.inbox_timeline:e?za.Timelines.low_quality_timeline:za.Timelines.requests_timeline}const qa={activeVoiceMessage:[null,null],playerApi:null,playerState:null,scribeAction:null},Ga=r.createContext({activeVoiceMessage:[qa.activeVoiceMessage,Qa],playerApi:[qa.playerApi,Qa],playerState:[qa.playerState,Qa],scribeAction:null});function Qa(){throw new Error("DMVoiceContext is not initialized")}function Ya(e){const{featureSwitches:t}=r.useContext(Q.a);return t.isTrue("dm_voice_rendering_enabled")?r.createElement(Ha,null,e.children,r.createElement(Ua,null)):e.children}const Ka=Ga;var $a=i("MH+I"),Ja=i("5Ixf"),Xa=i("AtEG");function Za(e){var t,i;const n=r.useContext(Ka),{isLowQuality:a,isSent:s,isTrusted:o}=e;if(!(null==(t=e.media)?void 0:t.video_info))return null;const[c,l]=n.activeVoiceMessage,[d]=n.playerApi,[u]=n.playerState,{scribeAction:p}=n,[h]=c,m=e.messageId===h;if(!p)return null;const b=tr(u),g=(null==(i=e.media)?void 0:i.video_info.duration_millis)||0,v={durationMs:g,isActive:m,isSent:s,playerApi:null,playerState:null,onImpression:()=>p.impression({isLowQuality:a,isTrusted:o}),onPlayRequest:()=>l([e.messageId,e.media]),onPlay:()=>p.play({data:{duration_ms:g}}),onPause:()=>p.pause()};return m&&b&&b.contentId===e.media.id_str&&(v.playerApi=d,v.playerState=u,(null==b?void 0:b.durationMs)&&(v.durationMs=null==b?void 0:b.durationMs)),r.createElement(er,v)}function er(e){const{isActive:t,isSent:i,playerState:n,playerApi:a}=e,s=null==n?void 0:n.isPlaying,o=tr(n),c=(null==o?void 0:o.currentTimeMs)||0,l=(null==o?void 0:o.durationMs)||e.durationMs,d=Math.max(t?l-c:l,0);r.useLayoutEffect(()=>{e.onImpression()},[]),r.useEffect(()=>{a&&0===c&&(a.play(),e.onPlay())},[a]);const u=J.a.isDarkMode()||i,p={color:u?"whiteOnColor":"normal"},h=[ar.voiceMessage,rr({isSent:i,squared:t}),i?ar.voiceMessageSent:ar.voiceMessageReceived,Ce(J.a.theme.scale).voiceMessage({isVoiceMessageActive:t,isSent:i})],m=s?Ja.a:Xa.a;return r.createElement(le.a,{style:[ar.container,Ce(J.a.theme.scale).voiceMessageContainer({isVoiceMessageActive:t,isSent:i})]},r.createElement(le.a,{style:h},r.createElement(le.a,{style:ar.startSpacer}),r.createElement(lt.a,{accessibilityLabel:s?nr:ir,icon:r.createElement(m,{style:u?ar.iconColorDark:ar.iconColorDefault}),onPress:()=>{a?s?(a.pause(),e.onPause()):(a.play(),e.onPlay()):e.onPlayRequest()},size:"normal",type:"invertedText"}),r.createElement(le.a,{style:ar.durationSpacer}),r.createElement(le.a,{style:i?ar.durationOpacity:void 0},r.createElement($a.a,zt()({countdown:!0,timeMs:d},p,{color:"gray600",size:"small",style:i?ar.durationDark:void 0,weight:"bold",withCountdownSymbol:t}))),r.createElement(le.a,{style:ar.endSpacer})))}const tr=e=>e?e.tracks[e.currentTrackId]:null,ir=je.a.c94b7d89,nr=je.a.eb6f9582,ar=J.a.create(e=>({displayNone:{display:"none"},container:{flexDirection:"row",alignSelf:"flex-end",alignItems:"center",justifyContent:"center"},voiceMessage:{alignSelf:"flex-end",flexDirection:ye.a.isRTL?"row-reverse":"row",alignItems:"center",justifyContent:"center"},voiceMessageSent:{backgroundColor:e.colors.primary},voiceMessageReceived:{backgroundColor:e.colors.dmReceivedBubbleBackground},durationSpacer:{width:e.spaces.xxSmall},durationOpacity:{opacity:.75},durationDark:{color:e.colors.whiteOnColor},iconColorDark:{color:e.colors.whiteOnColor},iconColorDefault:{color:e.colors.gray900},startSpacer:{width:e.spaces.xxSmall},endSpacer:{width:e.spaces.small}}));function rr({isSent:e,squared:t}){return[sr.base,e?sr.sent:sr.received,t?e?sr.sentSquared:sr.receivedSquared:void 0]}const sr=J.a.create(e=>({base:{borderRadius:e.borderRadii.xLarge,WebkitMaskImage:"url(data:image/png;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICRAEAOw==)"},sent:{borderBottomRightRadius:e.borderRadii.none},sentSquared:{borderTopRightRadius:e.borderRadii.none},received:{borderBottomLeftRadius:e.borderRadii.none},receivedSquared:{borderTopLeftRadius:e.borderRadii.none}}));class or extends r.Component{constructor(e,t){super(e,t),a()(this,"_fleetsDMConsumptionEnabled",this.context.featureSwitches.isTrue("responsive_web_fleets_dm_consumption_enabled")),a()(this,"_handleIsFleetAvailable",e=>{const{isFleetAttachmentAvailable:t}=this.state;e!==t&&this.setState({isFleetAttachmentAvailable:e})}),this.state={isFleetAttachmentAvailable:!En(e.entry)}}render(){const{entry:e,isSent:t,onCtaClick:i,onCtaImpression:n}=this.props,{isFleetAttachmentAvailable:a}=this.state,{message_data:s}=e,o=s&&s.attachment?s.attachment:{},c=e.marked_as_spam,l=gt(e),d=!!s&&!!s.ctas,u=bt(e),p=(e=>{const{message_data:t}=e;if(!t)return!1;if(gt(e)&&!vt(e))return!1;if(!t.text)return!1;const i=Object(ht.parse)(t.text);if(!i||0===i.length)return!1;const n=i.sort((e,t)=>t.indices[1]-e.indices[1]).reduce((e,t)=>`${e.slice(0,t.indices[0])}${e.slice(t.indices[1])}`,t.text).trim();return i.length<=10&&0===n.length})(e),h=!(u&&p),m=vt(e);let b;b=o.sticker?r.createElement(Ma,{sticker:o.sticker}):this._renderDMMessage(u,d,h);const g=c?r.createElement(xa,{conversationId:e.conversation_id,dmId:e.id},b):b,v=l&&!m&&!Object(C.b)(null==s?void 0:s.attachment,this.context.featureSwitches),f=[this._fleetsDMConsumptionEnabled&&m&&a&&cr.fleetRoot,t?cr.isSent:cr.isReceived,d&&cr.withCta,v?cr.mediaRoot:cr.flexShrink,this.props.style];return r.createElement(le.a,{style:f},g,s&&s.ctas?r.createElement(nn,{callToActions:s.ctas,isSent:t,onCtaClick:i,onImpression:n,withSticker:!!o.sticker||p,withUserText:u}):null)}_renderDMMessage(e,t,i){const{entry:n,isActive:a,isDmNsfwMediaFilterEnabled:s,isFirstRapidFire:o,isLowQuality:c,isRapidFire:l,isSent:d,isTrusted:u,displaySensitiveMedia:p}=this.props,{message_data:h,error:m}=n,b=h&&Object.assign({},h,{entities:h&&h.entities||void 0,error:m}),g=null==b?void 0:b.attachment,v={isActive:a,isFailedDraft:!!m,isFirstRapidFire:o,isRapidFire:l,isSent:d,withCta:t,withMessageBubble:i};if(b&&g){if(g.tweet)return r.createElement(ja,zt()({conversationId:n.conversation_id,hasUserText:e,isTrusted:u,messageData:b},v));if(g.photo||g.animated_gif||g.video)return g.video&&Object(C.b)(g,this.context.featureSwitches)?r.createElement(Za,{isLowQuality:c,isSent:!!d,isTrusted:u,media:g.video,messageId:n.id}):r.createElement(va,zt()({displaySensitiveMedia:p,entry:n,hasUserText:e,isDmNsfwMediaFilterEnabled:s,isTrusted:u,messageData:b},v));if(g.card)return r.createElement(vn,zt()({cardUrl:g.card,conversationId:n.conversation_id,hasUserText:e,messageData:b},v));if(g.fleet)return r.createElement(Vn,zt()({entry:n,fleetId:g.fleet.fleet_id,hasUserText:e,messageData:b,onIsFleetAvailable:this._handleIsFleetAvailable},v))}return r.createElement(Aa,zt()({},v,{messageData:b}))}}a()(or,"contextType",Q.a);const cr=J.a.create(e=>({flexShrink:{flexShrink:1},fleetRoot:{flex:.7},mediaRoot:{flex:1},isSent:{alignItems:"flex-end"},isReceived:{alignItems:"flex-start"},withCta:{alignItems:"stretch"}}));var lr=or;const dr=J.a.create(e=>({avatar:{borderRadius:e.borderRadii.infinite}}));var ur=({showAvatar:e,size:t="xLarge",user:i})=>e?r.createElement(ue.default,{accessibilityLabel:i.name,circle:!0,link:{pathname:"/"+i.screen_name},size:t,style:dr.avatar,uri:i.profile_image_url_https}):r.createElement(le.a,{style:[dr.avatar,ue.default.getSizeStyle(t)]}),pr=i("LdEA"),hr=i.n(pr),mr=i("B3eJ");function br(e){let{color:t,isActive:i,size:n}=e,a=hr()(e,["color","isActive","size"]);const s=r.useContext(Ka),[o,c]=r.useState(.5),[l]=s.playerState;r.useEffect(()=>{i&&l&&l.isPlaying&&c(Math.random())},[i,l]);const d=i&&(null==l?void 0:l.isPlaying),u=n+2*gr,p=[vr.container,a.style,{width:n,height:n}];return r.createElement(le.a,{style:p},r.createElement(le.a,{style:[vr.container,vr.transitionOpacity,d?vr.show:vr.hide]},Ee.a.reducedMotionEnabled?null:r.createElement(mr.a,{audioLevel:o,color:t,paused:!d,size:n})),r.createElement(le.a,{style:[vr.border,{width:u,height:u},vr.transitionOpacity,i?vr.show:vr.hide]}))}const gr=parseInt(J.a.theme.spaces.micro,10),vr=J.a.create(e=>({container:{alignItems:"center",justifyContent:"center",pointerEvents:"none"},border:{position:"absolute",top:-1*gr,left:-1*gr,backgroundColor:e.colors.navigationBackground,borderRadius:e.borderRadii.infinite},transitionOpacity:{transition:"opacity 0.2s 0s ease-in-out"},hide:{opacity:0},show:{opacity:1}}));var fr=i("uArA"),_r="messageEntry";const yr={element:"cta_dm"},Er={isGroupDM:!1,isRapidFire:!1,isFirstRapidFire:!1,isLastRapidFire:!1};class Cr extends r.Component{constructor(...e){super(...e),a()(this,"_handleClick",Object(fr.a)(()=>{const{entry:{error:e,id:t,is_draft:i},isActive:n,setActiveEntry:a}=this.props;i||e||(a(n?null:t),this._handleScribeMessageEntryClick())})),a()(this,"_handleScribeMessageEntryClick",()=>{const{isActive:e}=this.props;if(!dt.a.isEnabled&&!e){const{entry:e}=this.props,t={component:"message",element:Object(C.a)(e),action:"click"};this._scribeAction(t)}}),a()(this,"_handleCtaImpression",()=>{this._scribeAction(Object.assign({},yr,{action:"show"}))}),a()(this,"_handleCtaClick",()=>{this._scribeAction(Object.assign({},yr,{action:"click"}))}),a()(this,"_isDMVoiceMessage",()=>{var e;return Object(C.b)(null==(e=this.props.entry.message_data)?void 0:e.attachment,this.context.featureSwitches)})}shouldComponentUpdate(e){return!Object(ce.a)(this.props,e)}render(){const{isActive:e,isSent:t,user:i}=this.props,n=this._getRapidFireProps(),a=n.isRapidFire&&!n.isLastRapidFire,s=[xr.root.base,a&&xr.root.footerSpacing];if(!i)return null;const o=!dt.a.isEnabled||t;return r.createElement(le.a,{style:s},r.createElement(Z.a,{accessible:!0,"aria-expanded":o&&e?"true":"false",interactiveStyles:null,onPress:o?this._handleClick:void 0,style:[t?xr.root.sent:xr.root.received],testID:_r},({isFocused:e,isHovered:t})=>this._renderMessage({isFocused:e,isHovered:t,rapidFireProps:n})),this._renderFooter(n))}_renderMessage({isHovered:e,isFocused:t,rapidFireProps:i}){const{displaySensitiveMedia:n,entry:a,isActive:s,isDmNsfwMediaFilterEnabled:o,isLowQuality:c,isVoiceMessageActive:l,isWide:d,isReadOnly:u,isSent:p,isTrusted:h,perspective:m,scribeVoiceMessage:b,setShouldFreezeUpdates:g}=this.props,{isFirstRapidFire:v,isRapidFire:f}=i,_=[p?xr.messageContainer.sent:xr.messageContainer.received,d?xr.messageContainer.wide:xr.messageContainer.narrow,p&&d&&xr.messageContainer.sentWide,!p&&d&&xr.messageContainer.receivedWide],y=h&&!u,E=this._isDMVoiceMessage();return r.createElement(le.a,{style:_},a.error?null:r.createElement(Bt,{containerIsActive:s,containerIsFocused:t,containerIsHovered:e,entry:a,isDraft:!!a.is_draft,isSent:p,onReportMessage:E&&b?()=>b.report({isLowQuality:c,isTrusted:h}):void 0,perspective:m,setShouldFreezeUpdates:g,shouldShowReactionButton:y,style:E&&Ce(J.a.theme.scale).actionsContainer({isSent:p,isVoiceMessageActive:l})}),r.createElement(lr,{displaySensitiveMedia:n,entry:a,isActive:s,isDmNsfwMediaFilterEnabled:o,isFirstRapidFire:v,isLowQuality:c,isRapidFire:f,isSent:p,isTrusted:h,key:a.id,onCtaClick:this._handleClick,onCtaImpression:this._handleCtaImpression,style:E&&Ce(J.a.theme.scale).messageContainer({isSent:p,isVoiceMessageActive:l})}),this._possiblyRenderUserAvatar(i))}_renderFooter({isLastRapidFire:e,isRapidFire:t}){var i,n;const{isGroupDM:a,entry:s,isActive:o,isSent:c,participants:l,user:d}=this.props;return r.createElement($i,{conversationId:s.conversation_id,entryId:s.id,entryText:null==(i=s.message_data)?void 0:i.text,entryTime:s.time,isActive:o,isDraft:!!s.is_draft,isError:!!s.error,isGroupDM:a,isLastRapidFire:e,isRapidFire:t,isSent:c,localMediaId:null==(n=s.message_data)?void 0:n.localMediaId,onPress:this._handleClick,participants:l,user:d})}_possiblyRenderUserAvatar({isLastRapidFire:e,isRapidFire:t}){const{isSent:i,isVoiceMessageActive:n,user:a}=this.props,s=this._isDMVoiceMessage();if(!a||i&&!s)return null;const{DMUserAvatarSizePx:o,DMUserAvatarSizeType:c}=_e(J.a.theme.scale),l={showAvatar:!!s||(!t||!!e),size:c,user:a},d=[xr.userAvatar.base,i?xr.userAvatar.sent:xr.userAvatar.received,s&&Ce(J.a.theme.scale).userAvatar({isVoiceMessageActive:n,isSent:i})];return r.createElement(le.a,{style:xr.userAvatar.container},i?null:r.createElement(le.a,{style:xr.userAvatar.spacer}),s?r.createElement(br,{color:i?J.a.theme.colors.primary:J.a.theme.colors.text,isActive:!!n,size:o,style:d}):null,r.createElement(le.a,{style:d},r.createElement(ur,l)))}_scribeAction(e){const{analytics:t}=this.props;t.scribe(Object.assign({},e))}_getRapidFireProps(){return{isFirstRapidFire:this.props.isFirstRapidFire,isLastRapidFire:this.props.isLastRapidFire,isRapidFire:this.props.isRapidFire}}}a()(Cr,"contextType",Q.a),a()(Cr,"defaultProps",Er);var Sr=Object(Je.a)(Te(function(e){function t(t){const{entry:i}=t,n=r.useContext(Ka),[a]=n.activeVoiceMessage,{scribeAction:s}=n,[o]=a,c=o===i.id,l=Object.assign({},t,{isVoiceMessageActive:c,scribeVoiceMessage:s});return r.createElement(e,l)}return t.defaultProps=Er,t}(Cr)));const xr={root:J.a.create(e=>({base:{flexDirection:"column",paddingBottom:e.spaces.medium},received:{cursor:"default",alignItems:"flex-start"},sent:{cursor:"pointer",alignItems:"flex-end"},footerSpacing:{paddingBottom:e.spaces.micro}})),messageContainer:J.a.create(e=>({sent:{flexDirection:"row",justifyContent:"flex-end"},received:{flexDirection:"row-reverse",justifyContent:"flex-end"},narrow:{width:"100%"},wide:{width:"87.5%"},receivedWide:{paddingRight:e.spaces.xSmall},sentWide:{paddingLeft:e.spaces.xSmall}})),userAvatar:J.a.create(e=>({container:{flexDirection:"row",alignItems:"flex-end"},base:{position:"absolute"},sent:{right:0},received:{left:0},spacer:{width:_e(e.scale).DMUserAvatarSpacerPx}}))};var Rr=i("H4nC");class Ar extends r.Component{shouldComponentUpdate(e){return!Object(ce.a)(this.props,e)}render(){const{conversation:e,entry:t,isActive:i,isWide:n,isFirstRapidFire:a,isLastRapidFire:s,isRapidFire:o,perspective:l,scribeNamespace:d,setActiveEntry:u,setShouldFreezeUpdates:p}=this.props;if(Object(V.b)(t)||Object(V.e)(t)){const{conversation_id:h,low_quality:m,participants:b,read_only:g,trusted:v,type:f}=e,{message_data:{sender_id:_}={}}=t,y=void 0===h||v;return r.createElement(Sr,{entry:t,isActive:i,isFirstRapidFire:a,isGroupDM:f===c.CONVERSATION_TYPE.GROUP,isLastRapidFire:s,isLowQuality:!!m,isRapidFire:o,isReadOnly:g,isSent:_===l,isTrusted:!!y,isWide:n,participants:b,perspective:l,scribeNamespace:d,senderId:_,setActiveEntry:u,setShouldFreezeUpdates:p})}return Object(V.a)(t)?r.createElement(ve,{conversation:e,entry:t,entryType:t.type,perspective:l}):Object(V.d)(t)?r.createElement(Rr.a,{entry:t,isCompact:!1}):null}}a()(Ar,"defaultProps",{isActive:!1});const wr=Object(m.createSelector)((e,t)=>{const i=Object(He.o)(e,t.conversationId),n=i&&Object(G.a)(i);return n&&Object(c.selectEntry)(e,n)},e=>({lastEntry:e}));var Ir=Object(p.c)(wr);i("Ef13");const Or=Object(m.createSelector)((e,t)=>y.e.selectMany(e,t.userIds||[]),e=>({users:e}));var Mr=Object(Vt.b)(Or),Tr=i("Enqy"),kr=i("+/1j");const Lr=(e,t)=>e.id_str<t.id_str?-1:e.id_str>t.id_str?1:0,Dr={stiffness:1e3,damping:70},Fr={scale:Object(Tr.spring)(1,Dr),translateY:Object(Tr.spring)(0,Dr)},Pr=(e,t)=>({key:e.id_str,data:e,style:Fr}),jr=Object(F.a)({translateY:140,scale:0}),Br=Object(F.a)({scale:Object(Tr.spring)(1,Dr),translateY:Object(Tr.spring)(140,Dr)}),Nr=[{key:"bubble",style:{scale:Object(Tr.spring)(1,Dr),translateY:Object(Tr.spring)(0,Dr)}}],Ur=Object(F.a)({translateY:140,scale:0}),Wr=Object(F.a)({scale:Object(Tr.spring)(1,Dr),translateY:Object(Tr.spring)(140,Dr)}),Hr=e=>[isFinite(e.scale)&&{scale:e.scale.toFixed(3)},isFinite(e.translateY)&&{translateY:Math.round(e.translateY)+"%"}].filter(Boolean);class zr extends r.Component{constructor(...e){super(...e),a()(this,"state",{isHidden:!0}),a()(this,"_afterLeave",()=>{const{users:e}=this.props;this.setState(t=>({isHidden:0===e.length}))})}componentDidUpdate(e,t){this.state.isHidden&&this.props.users&&this.props.users.length&&this.setState({isHidden:!1})}shouldComponentUpdate(e,t){return!Object(ce.a)(this.props,e)||!Object(ce.a)(this.state,t)}render(){const{isHidden:e}=this.state,{users:t}=this.props,i=t.sort(Lr).slice(0,5).map(Pr);return t.length>5&&i.push({key:"overflow",style:Fr}),r.createElement(le.a,{style:[Vr.root,e&&Vr.hidden]},r.createElement(le.a,{style:Vr.avatarRow},r.createElement(Tr.TransitionMotion,{styles:i,willEnter:jr,willLeave:Br},e=>r.createElement(r.Fragment,null,e.map((e,i)=>{if(e.style.scale<=.05)return null;const n=Hr(e.style);return"overflow"===e.key?r.createElement(le.a,{key:e.key,style:[Vr.avatar,Vr.avatarSpacer,Vr.overflowAvatar,{transform:n}]},r.createElement(kr.a,{style:Vr.overflowAvatarText},"+",t.length-5)):r.createElement(le.a,{key:e.key,style:[Vr.avatar,{transform:n}]},r.createElement(ue.default,{accessibilityLabel:e.data&&e.data.name,size:"xLarge",uri:e.data&&e.data.profile_image_url_https}))})))),r.createElement(Tr.TransitionMotion,{didLeave:this._afterLeave,styles:t.length>0?Nr:[],willEnter:Ur,willLeave:Wr},e=>r.createElement(r.Fragment,null,e.map(e=>r.createElement(le.a,{key:e.key,style:[Vr.messageBubble,{transform:Hr(e.style)}]},r.createElement(le.a,{style:Vr.dot}),r.createElement(le.a,{style:[Vr.dot,Vr.dot1]}),r.createElement(le.a,{style:[Vr.dot,Vr.dot2]}))))))}}const Vr=J.a.create(e=>({root:{flexDirection:"row",paddingBottom:e.spaces.medium,paddingRight:e.spaces.xSmall,width:"calc(100% * 7/8)",position:"relative",transitionProperty:"height, padding-bottom",transitionDuration:"0.2s",overflow:"hidden"},hidden:{paddingBottom:0,paddingRight:0,height:0,width:0},avatarRow:{display:"inline-flex",alignItems:"flex-start",flexDirection:"row"},avatar:{marginEnd:e.spaces.xSmall,transformOrigin:"50% 100%"},avatarSpacer:{height:e.spaces.xLarge,width:e.spaces.xLarge},overflowAvatar:{borderRadius:e.borderRadii.infinite,backgroundColor:e.colors.primary,alignItems:"center",justifyContent:"center"},overflowAvatarText:{color:"white"},messageBubble:{alignItems:"center",borderRadius:e.borderRadii.infinite,maxWidth:"100%",paddingVertical:e.spaces.xSmall,paddingHorizontal:e.spaces.small,backgroundColor:e.colors.gray50,borderBottomLeftRadius:e.borderRadii.none,borderColor:e.colors.gray200,flexDirection:"row",height:e.spaces.xLarge,overflow:"hidden",transformOrigin:"0% 100%"},dot:{display:"flex-inline",position:"relative",width:e.spaces.xSmall,height:e.spaces.xSmall,overflow:"hidden",borderRadius:e.borderRadii.infinite,backgroundColor:e.colors.gray600,marginEnd:e.spaces.xxSmall,animationDuration:"1.2s",animationIterationCount:"infinite",animationTimingFunction:"linear",animationKeyframes:[{"15%":{transform:[{scale:1.4}],backgroundColor:e.colors.primary},"30%":{transform:[{scale:1}]}}]},dot1:{animationDelay:"0.1s"},dot2:{animationDelay:"0.2s"}}));var qr=Mr(zr),Gr=i("tn7R");class Qr extends r.PureComponent{constructor(...e){super(...e),a()(this,"_timers",{}),a()(this,"state",{forceHide:!1,userIds:[]}),a()(this,"_handleLivePipelineUpdate",e=>{const{user_id:t}=e.dm_typing;t!==this.context.loggedInUserId&&(this._timers[t]&&clearTimeout(this._timers[t]),this._timers[t]=setTimeout(()=>this._removeAvatar(t),4e3),this.setState(e=>({forceHide:!1,userIds:[...e.userIds.filter(e=>e!==t),t]})))}),a()(this,"_removeAvatar",(e,t=!1)=>{this.setState(i=>{const n=i.userIds.filter(t=>t!==e);return{forceHide:t&&0===n.length,userIds:n}})})}componentDidMount(){this._initializeLivePipeline()}UNSAFE_componentWillReceiveProps(e){if(e.lastEntry){const{lastEntry:t={}}=this.props||{},{lastEntry:i}=e;t&&t.id!==i.id&&i.message_data&&this._removeAvatar(i.message_data.sender_id,!0)}}componentDidUpdate(e,t){e.conversationId!==this.props.conversationId&&(this._teardownLivePipeline(),this._initializeLivePipeline())}componentWillUnmount(){this._teardownLivePipeline()}render(){const{forceHide:e,userIds:t}=this.state;return!e&&r.createElement(qr,{conversationId:this.props.conversationId,userIds:t})}_teardownLivePipeline(){Object(Gr.a)(this._timers).forEach(e=>clearTimeout(e)),this._livePipelineSubscription&&this._livePipelineSubscription.teardown()}_initializeLivePipeline(){const{conversationId:e}=this.props;Object(s.h)().then(({LivePipeline:t})=>{t.isSupportedAndReady(k.b)&&k.b.isTrue("livepipeline_dm_features_enabled")&&!this._livePipelineSubscription&&(this._livePipelineSubscription=t.get().subscribeTopic("/dm_typing/"+e,this._handleLivePipelineUpdate))})}}a()(Qr,"contextType",Q.a);var Yr=Ir(Qr),Kr=i("yw4N"),$r=i("9YUM"),Jr=i("mw9i");const Xr=je.a.i859a9d3,Zr=je.a.i8ecae5b,es=je.a.ffde2fdb,ts=()=>r.createElement(le.a,{style:as.spinner},r.createElement(Mn.a,{accessibilityLabel:es})),is=e=>e.entry.id;class ns extends r.Component{constructor(e,t){super(e,t),a()(this,"_renderItem",e=>{const{conversation:t}=this.props,i=t.conversation_id;switch(e.type){case N.b.TYPING_INDICATOR:return i?r.createElement(Yr,{conversationId:i}):null;case N.b.READ_ONLY_INDICATOR:return i?r.createElement(le.a,{style:as.readOnly},r.createElement(de.c,{align:"center",color:"gray600",size:"small"},Zr," ",r.createElement(de.c,{link:"https://support.twitter.com/articles/14606#faq"},Xr))):null;case N.b.CONVERSATION_PROFILE_INFO_HEADER:return r.createElement(re,{conversation:t});default:return this._renderDMEntry(e)}}),a()(this,"_setActiveEntry",e=>{this.setState({activeEntryId:e})}),a()(this,"_setShouldFreezeUpdates",e=>{this.setState({shouldFreezeUpdates:e})}),this._anchoring=B({isOwnMessage:e=>{var t,i;return(null==(t=e.entry)||null==(i=t.message_data)?void 0:i.sender_id)===this.props.perspective||!1},typingIndicatorId:"typingIndicator"}),this.state={activeEntryId:null,shouldFreezeUpdates:!1}}shouldComponentUpdate(e,t){return!1===t.shouldFreezeUpdates}render(){const{conversation:e,style:t,onHistoryRequest:i}=this.props,{activeEntryId:n}=this.state,a=(({conversation:e,footer:t,readOnlyEntry:i,canInjectConversationProfileInfoHeader:n,activeEntryId:a})=>{const r=e&&e.entries||[],s=r.reduce((e,t,i)=>{n&&0===i&&e.push(W);const s=Object(G.a)(e),o=i===r.length-1;if(e.push({isRapidFire:!1,isFirstRapidFire:!1,isLastRapidFire:!1,entry:t,isActive:a===t.id}),s){const i=q(s.entry,t),n=e[e.length-2];i?(e[e.length-1].isRapidFire=!0,n.isRapidFire||(n.isFirstRapidFire=!0,n.isRapidFire=!0),o&&(e[e.length-1].isLastRapidFire=!0)):n.isRapidFire&&(n.isLastRapidFire=!0)}return e},[]);return t&&s.push(t),e.read_only&&i&&s.push(i),s})({conversation:e,footer:H,readOnlyEntry:z,canInjectConversationProfileInfoHeader:e.status===N.c.AT_END&&e.type===N.a.ONE_TO_ONE,activeEntryId:n}),s=e.conversation_id;return r.createElement(Kr.a,{style:[as.scrollContainer,t]},e.status&&e.status!==N.c.AT_END?r.createElement(ts,null):null,r.createElement(Jr.a,{style:[as.content,as.alignTop],withGutter:!0},r.createElement($r.a,{anchoring:this._anchoring,assumedItemHeight:100,cacheKey:"dm-activity-"+s,identityFunction:is,initialAnchor:a.length>0?L.a(is((o=a,o[o.length-1]))):void 0,items:a,nearStartProximityRatio:2,onNearStart:i,renderer:this._renderItem})));var o}_renderDMEntry({entry:e,isActive:t,isFirstRapidFire:i,isLastRapidFire:n,isRapidFire:a}){const{conversation:s,isWide:o,perspective:c,scribeNamespace:l}=this.props;return e&&r.createElement(Ar,{conversation:s,entry:e,isActive:t,isFirstRapidFire:i,isLastRapidFire:n,isRapidFire:a,isWide:o,key:e.id,perspective:c,scribeNamespace:l,setActiveEntry:this._setActiveEntry,setShouldFreezeUpdates:this._setShouldFreezeUpdates})}}const as=J.a.create(e=>({spinner:{alignItems:"center",marginVertical:"30px"},scrollContainer:{backgroundColor:e.colors.cellBackground,flexGrow:1,maxHeight:"100%",overflowX:"hidden",paddingTop:e.spaces.medium,WebkitOverflowScrolling:"touch"},content:{flexGrow:1,transform:[{translate3d:"0,0,0"}]},alignTop:{justifyContent:"flex-start"},readOnly:{paddingBottom:e.spaces.medium}}));var rs=i("uB9N"),ss=i("v//M"),os=i("J2UM"),cs=i("07FG"),ls=i("I8M8"),ds=i("7myi"),us=i("883S"),ps=i("z0MJ"),hs=i.n(ps),ms=i("Es6L"),bs=i("LsPn"),gs=i("GSsg"),vs=(i("WNMA"),i("EbOo"));var fs=Object(_n.a)().propsFromActions(()=>({addToast:u.b,block:y.e.block,createLocalApiErrorHandler:Object(h.d)("UNTRUSTED_CONVERSATION_ACTIONS"),muteDMUser:c.muteDMUser,unmuteDMUser:c.unmuteDMUser,unblock:y.e.unblock})),_s=i("CKsB"),ys=i("w02m"),Es=i("qz6Z"),Cs=i("pu5c");const Ss=je.a.e67b2d65,xs=je.a.jd44c4e4,Rs=je.a.f05597b2,As=je.a.g9c74283,ws=je.a.fcd4d489,Is=je.a.gbed8594,Os=je.a.j7bb1a42,Ms=je.a.ea200ba6,Ts=je.a.cfd2f35d,ks=J.a.create(e=>({roundCorners:{borderRadius:e.borderRadii.xLarge},flatCorners:{borderRadius:e.borderRadii.none},cancelButton:{marginHorizontal:e.spaces.small,marginVertical:e.spaces.small}}));var Ls=({dismiss:e,isMuted:t,onMuteDMUserClick:i,onUnmuteDMUserClick:n,onReportClick:a,onBlockClick:s,requestorScreenName:o,flatBorders:c=!1,showCancel:l=!1,showMute:d=!1})=>{const u=r.useCallback(()=>{i&&i(),e()},[e,i]),p=r.useCallback(()=>{n&&n(),e()},[e,n]),h=r.useCallback(()=>{a&&a(),e()},[e,a]),m=r.useCallback(()=>{s&&s(),e()},[e,s]);return r.createElement(le.a,{accessibilityRole:"dialog",style:c?ks.flatCorners:ks.roundCorners},d?t?r.createElement(_s.a,{Icon:ys.a,actionSubText:As,actionText:Rs({screenName:o}),onClick:p}):r.createElement(_s.a,{Icon:Es.a,actionSubText:xs,actionText:Ss({screenName:o}),onClick:u}):null,r.createElement(_s.a,{Icon:Cs.a,actionSubText:Is,actionText:ws({screenName:o}),onClick:m}),r.createElement(_s.a,{Icon:yt.a,actionSubText:Ms,actionText:Os({screenName:o}),onClick:h}),l?r.createElement(lt.a,{onPress:e,style:ks.cancelButton,type:"neutral"},Ts):null)};const Ds=je.a.ccf2f24e,Fs=je.a.ib3fe8a9,Ps=je.a.a5e50981;var js=({isGroup:e,isMuted:t,onMuteDMUserClick:i,onUnmuteDMUserClick:n,onBlockClick:a,onReportClick:s,requestorScreenName:o})=>{const{featureSwitches:c}=r.useContext(Q.a),l=c.isTrue("dm_conversations_muting_enabled"),d={backgroundColor:"transparent",borderColor:"gray600",color:"gray600",size:"normal"},u=r.createElement(lt.a,d,l?Ps:Fs),p=r.createElement(lt.a,zt()({},d,{onPress:s}),Ds),h=r.useCallback((e,c)=>r.createElement(Ls,{dismiss:e,flatBorders:"sheet"===c,isMuted:t,onBlockClick:a,onMuteDMUserClick:i,onReportClick:s,onUnmuteDMUserClick:n,requestorScreenName:o,showCancel:"sheet"===c,showMute:l}),[t,l,i,n,a,s,o]);return e?p:r.createElement(bi.a,{renderContent:h},u)},Bs=i("u0B7"),Ns=i("aITJ"),Us=i("lHOd"),Ws=i("GygS"),Hs=i("vMjK");const zs=je.a.da878dcf,Vs=je.a.d96cf7cd,qs=je.a.gde6b424,Gs=je.a.e308019b,Qs=je.a.gf5e9ea6,Ys=je.a.hc52446b,Ks=je.a.f7e1ad65,$s={headline:je.a.gdf4b79f,text:je.a.bbf83d83,confirmButtonLabel:je.a.bb1d57b6},Js={headline:je.a.e067c8bd,text:je.a.ddaeefd7,confirmButtonLabel:je.a.da878dcf};class Xs extends r.PureComponent{constructor(e,t){super(e,t),a()(this,"_renderCopy",e=>r.createElement(de.c,{style:Zs.copy},e?Ys:Ks({senderName:this._getTheOtherParticipantFromOneToOneConvo().name}))),a()(this,"_renderActionButtons",e=>{const{conversation:t}=this.props;return r.createElement(ia.a,null,({windowWidth:i})=>{const n=i<=J.a.theme.breakpoints.small;return r.createElement(le.a,{style:Zs.actionsContainer},r.createElement(le.a,{style:n?Zs.actionFullWidth:[Zs.actionHalfWidth,Zs.actionMarginRight]},r.createElement(Us.a.Consumer,null,i=>r.createElement(js,{isGroup:e,isMuted:!!t.muted,onBlockClick:this._handleBlockClick,onMuteDMUserClick:this._handleMuteDMUserClick(i),onReportClick:this._handleReportMenuItemClick,onUnmuteDMUserClick:this._handleUnmuteDMUserClick(i),requestorScreenName:this._getTheOtherParticipantFromOneToOneConvo().screenName}))),r.createElement(lt.a,{onPress:this._handleLeaveConversationClick,size:"normal",style:n?[Zs.actionFullWidth,Zs.actionMarginTop]:[Zs.actionHalfWidth,Zs.actionMarginLeft],type:"destructiveSecondary"},Vs),r.createElement(lt.a,{onPress:this._handleAcceptConversation,size:"normal",style:[Zs.actionFullWidth,Zs.actionMarginTop],type:"secondary"},zs))})}),a()(this,"_renderLeaveConfirmationSheet",()=>r.createElement(ct.a,{confirmButtonLabel:$s.confirmButtonLabel,confirmButtonType:"destructive",headline:$s.headline,onCancel:this._handleCancelLeave,onConfirm:this._handleConfirmLeave,text:$s.text})),a()(this,"_renderAcceptMutedConfirmationSheet",()=>r.createElement(ct.a,{confirmButtonLabel:Js.confirmButtonLabel,confirmButtonType:"primary",headline:Js.headline,onCancel:this._handleCancelAcceptMuted,onConfirm:this._handleConfirmAccept,text:Js.text})),a()(this,"_renderBlockConfirmationSheet",()=>{const{screenName:e,idStr:t}=this._getTheOtherParticipantFromOneToOneConvo();return r.createElement(ct.a,{confirmButtonLabel:Ws.a,confirmButtonType:"destructive",headline:Object(Ws.c)({screenName:e}),onCancel:this._handleBlockLeave,onConfirm:this._createBlockUserHandler(t),text:Object(Ws.b)({screenName:e})})}),a()(this,"_scribeAction",e=>{const{scribeAction:t,scribeNamespace:i}=this.props;t(Object.assign({},i,{action:e}),this._getScribeData())}),a()(this,"_getScribeData",()=>{const{conversation:e}=this.props;return{items:[{conversation_type:e.type===c.CONVERSATION_TYPE.GROUP?1:0}]}}),a()(this,"_handleReportTextClick",()=>{this._scribeAction("report")}),a()(this,"_handleReportMenuItemClick",()=>{const{conversationId:e,history:t,scribeNamespace:i}=this.props;e&&(this._scribeAction("report"),t.push(((e,t,i)=>({pathname:"/i/report/dm_conversation/"+e,state:{clientReferer:t,scribeNamespace:i}}))(e,window.location.pathname,i)))}),a()(this,"_handleLeaveConversationClick",()=>{this.setState({showLeaveConfirmation:!0,showBlockConfirmation:!1})}),a()(this,"_handleMuteDMUserClick",e=>()=>{const{addToast:t,conversationId:i,createLocalApiErrorHandler:n,muteDMUser:a}=this.props,{idStr:r,name:s}=this._getTheOtherParticipantFromOneToOneConvo();a(r,i).then(()=>{t({action:{label:Qs,onAction:this._handleUnmuteDMUserClick(e)},text:qs({name:s})}),e.location.pathname.match("additional")||e.replace("/messages/requests")},n()),this._scribeAction("mute_user")}),a()(this,"_handleUnmuteDMUserClick",e=>()=>{const{addToast:t,conversationId:i,createLocalApiErrorHandler:n,unmuteDMUser:a}=this.props,{idStr:r,name:s}=this._getTheOtherParticipantFromOneToOneConvo();i&&(a(r,i).then(()=>{t({action:{label:Qs,onAction:this._handleMuteDMUserClick(e)},text:Gs({name:s})}),e.replace("/messages/requests/"+i)},n()),this._scribeAction("unmute_user"))}),a()(this,"_handleBlockClick",()=>{this.setState({showBlockConfirmation:!0,showLeaveConfirmation:!1})}),a()(this,"_handleCancelLeave",()=>{this.setState({showLeaveConfirmation:!1})}),a()(this,"_handleCancelAcceptMuted",()=>{this.setState({showAcceptMutedConfirmation:!1})}),a()(this,"_handleBlockLeave",()=>{this.setState({showBlockConfirmation:!1})}),a()(this,"_handleConfirmLeave",()=>{const{leaveConversation:e,conversation:t,conversationId:i,history:n}=this.props,a=t.type===c.CONVERSATION_TYPE.GROUP?"leave_group":"delete_thread";this.setState({showLeaveConfirmation:!1}),e({conversationId:i}),this._scribeAction(a),n.goBack()}),a()(this,"_handleConfirmAccept",()=>{const{acceptConversation:e,conversationId:t,scribeAction:i,scribeNamespace:n}=this.props,{showAcceptMutedConfirmation:a}=this.state;t&&(e(t),a?(i(Object.assign({},n,{element:"accept_muted_dialog",action:"accept"}),this._getScribeData()),this.setState({showAcceptMutedConfirmation:!1})):this._scribeAction("accept"))}),a()(this,"_handleAcceptConversation",()=>{const{conversation:e}=this.props;e.muted?this.setState({showAcceptMutedConfirmation:!0}):this._handleConfirmAccept()}),a()(this,"_createBlockUserHandler",e=>()=>{const{addToast:t,block:i,createLocalApiErrorHandler:n}=this.props;this.setState({showBlockConfirmation:!1}),i(e).then(()=>{t({action:{label:Hs.c,onAction:this._createUnblockUserHandler(e)},text:Hs.a})},n(vs.a)),this._scribeAction("block")}),a()(this,"_createUnblockUserHandler",e=>()=>{const{createLocalApiErrorHandler:t,unblock:i}=this.props;i(e).catch(t(Bs.a)),this._scribeAction("unblock")}),a()(this,"_getTheOtherParticipantFromOneToOneConvo",()=>{const{conversation:e}=this.props,{loggedInUserId:t}=this.context,i=Object(Y.a)(e,t).map(({user:e})=>e),n=i&&i[0];return{name:n&&n.name||"",screenName:n&&n.screen_name||"",idStr:n&&n.id_str||""}}),this.state={showAcceptMutedConfirmation:!1,showLeaveConfirmation:!1,showBlockConfirmation:!1}}componentDidMount(){this._scribeAction("impression")}render(){const{conversation:e}=this.props,{showAcceptMutedConfirmation:t,showBlockConfirmation:i,showLeaveConfirmation:n}=this.state,a=(e&&e.type)===c.CONVERSATION_TYPE.GROUP;return r.createElement(r.Fragment,null,r.createElement(le.a,{style:Zs.root},this._renderCopy(a),this._renderActionButtons(a)),Ns.a.isKaiOS()?r.createElement(bs.a,{leftText:Vs,onLeftClick:this._handleLeaveConversationClick,onRightClick:this._handleAcceptConversation,rightText:zs}):null,n?this._renderLeaveConfirmationSheet():null,t?this._renderAcceptMutedConfirmationSheet():null,i?this._renderBlockConfirmationSheet():null)}}a()(Xs,"contextType",Q.a);const Zs=J.a.create(e=>({root:{backgroundColor:e.colors.cellBackground,borderColor:e.colors.borderColor,borderTopStyle:"solid",borderTopWidth:"1px",paddingVertical:e.spaces.medium,paddingHorizontal:e.componentDimensions.gutterHorizontal},copy:{paddingBottom:e.spaces.medium},reportlink:{marginLeft:e.spaces.xxSmall},actionsContainer:{display:"flex",flexWrap:"wrap",flexDirection:"row"},actionFullWidth:{width:"100%"},actionHalfWidth:{width:`calc(50% - ${e.spaces.xxSmall})`},actionMarginRight:{marginRight:e.spaces.xxSmall},actionMarginLeft:{marginLeft:e.spaces.xxSmall},actionMarginTop:{marginTop:e.spaces.xSmall}}));var eo=Object(M.c)({element:"untrusted_interstitial"})(fs(Xs)),to=i("rFBM"),io=i("jTgF"),no=i("+d3d");const ao=je.a.badb01a0,ro=je.a.d6b11d9c,so=je.a.i7ca1446,oo=e=>e&&(e.tweet||e.media),co=({gifMetadata:e={},tweetAttachment:t,media:i})=>{let n;return t?n={tweet:t}:i?i.mediaFile?n={media:i}:i.externalMediaDetails&&(n={media:i,provider:e.provider,gifUrl:e.url}):n=null,n};class lo extends r.PureComponent{constructor(e){super(e),a()(this,"_composer",r.createRef()),a()(this,"_handleLivePipelineUpdate",()=>{this._fetchUpdatesIfNeeded(),this._updatePolling&&this._updatePolling.restart()}),a()(this,"_fetchUpdatesIfNeeded",()=>{const{conversationId:e,createLocalApiErrorHandler:t,fetchUpdatesIfNeeded:i,isDmReceiptSettingEnabled:n}=this.props;i(n?{active_conversation_id:e,dm_users:!0}:{}).catch(t())}),a()(this,"_handleInitialFetch",()=>{this._initialFetch()}),a()(this,"_initialFetch",()=>{const{conversationId:e,createLocalApiErrorHandler:t,fetchInboxIfNeeded:i,fetchUpdatesIfNeeded:n}=this.props;return i().then(()=>{if(e)return this._fetchConversation(e).then(()=>this._requestWelcomeMessage(e))}).then(()=>n()).catch(t()).finally(()=>{this._updatePolling&&this._updatePolling.start()})}),a()(this,"_isUntrustedConversation",e=>{const{isNewGroupConversation:t}=this.props;return!(null==e?void 0:e.trusted)&&!t}),a()(this,"_leaveConversation",e=>{const{createLocalApiErrorHandler:t,leaveConversation:i}=this.props;i(e).catch(t({showToast:!0}))}),a()(this,"_acceptConversation",e=>{const{acceptConversation:t,createLocalApiErrorHandler:i}=this.props;t(e).then(()=>{Ns.a.isMobileOS()&&this._fetchConversation(e)}).catch(i({showToast:!0}))}),a()(this,"_renderActions",()=>{const{conversation:e,conversationId:t,history:i,scribeAction:n}=this.props;return e&&this._isUntrustedConversation(e)?e.read_only?null:t&&r.createElement(eo,{acceptConversation:this._acceptConversation,conversation:e,conversationId:t,history:i,leaveConversation:this._leaveConversation,scribeAction:n}):r.createElement(r.Fragment,null,this._renderComposerBar(),Ns.a.isKaiOS()?r.createElement(bs.a,{leftText:so,onLeftClick:this._handleInfoClick,onRightClick:this._handleComposeClick,rightText:ao}):null)}),a()(this,"_render",()=>{const{conversation:e,conversationId:t,isWide:i,perspective:n,scribeNamespace:a}=this.props,{attachment:s,composerHeight:o}=this.state;return r.createElement(Ya,{key:t},r.createElement(to.a,{allowDragDrop:!oo(s),onFilesAdded:this._handleDragDrop,style:uo.dragDrop},r.createElement(Kr.a,{style:[uo.scrollView,!Object(ms.a)()&&!this._isUntrustedConversation(e)&&{paddingBottom:o}]},n&&e?r.createElement(ns,{conversation:e,isWide:i,onHistoryRequest:this._handleHistoryRequest,perspective:n,scribeNamespace:a,style:uo.activity}):null),this._renderActions()))}),a()(this,"_handleNavHeightChange",e=>{this.setState({composerHeight:e+"px"})}),a()(this,"_handleTyping",()=>{this._throttleSaveDraftText(),this._throttleUpdateTyping()}),a()(this,"_throttleUpdateTyping",Object(no.a)(()=>{const{conversationId:e,createLocalApiErrorHandler:t,updateTyping:i}=this.props;e&&i({conversationId:e}).catch(t())},2e3,{trailing:!1})),a()(this,"_throttleSaveDraftText",Object(no.a)(()=>{const{conversationId:e}=this.props;e&&this._handleSaveDraftText()},1e3,{leading:!1})),a()(this,"_handleDragDrop",e=>{this._currentComposer&&this._currentComposer._handleAddMediaFiles(e)}),a()(this,"_handleHistoryRequest",()=>{const{conversationId:e,fetchConversationHistory:t,createLocalApiErrorHandler:i}=this.props;t({conversationId:e}).catch(i())}),a()(this,"_handleSendMessage",(e,t)=>{const{addToast:i,cardUrl:n,conversationId:a,createLocalApiErrorHandler:r,gifMetadata:s,history:o,location:c,newConversationParticipants:l,perspective:d,scribeAction:u,scribeNamespace:p,sendMessage:h,tweetAttachment:m}=this.props;if(e.emoji||e.quickReply||(this._currentComposer&&this._currentComposer.clear(),this._currentComposer&&this._currentComposer.focus()),s&&u(Object.assign({},p,{element:"remote",action:"send_gif_dm"})),u(m?Object.assign({},p,{action:"send_tweet_dm"}):Object.assign({},p,{action:"send_dm"})),!a){return h({senderId:d,recipients:l&&l.map(({data:e})=>e.id_str),text:t,tweetAttachment:m}).then(e=>{this.setState({attachment:null}),o.replace("/messages/"+e)},r(us.b)),Promise.resolve()}return this.state.attachment&&(this.setState({attachment:null}),o.replace(c.pathname)),h(Object.assign({senderId:d,cardUrl:n,conversationId:a,text:t,tweetAttachment:m},e.quickReply&&{quickReply:e.quickReply})).catch(e=>{if(!Object(io.d)(e)||e.code!==ls.b.CANCELED)if(Object(io.d)(e)){const t=Object(io.b)(e,ro);t&&i(t)}else r(us.b)(e)})}),a()(this,"_handlePopOutConvo",()=>{const{conversationId:e,popOutConversation:t}=this.props;t(e)}),a()(this,"_handleInfoClick",()=>{const{history:e,conversationId:t}=this.props;t&&e.push(`/messages/${t}/info`)}),a()(this,"_handleComposeClick",()=>{this._currentComposer&&this._currentComposer.focus()}),a()(this,"_handleSaveDraftText",()=>{const{conversationId:e,saveText:t}=this.props;e&&this._currentComposer&&t(e,this._currentComposer.value())}),this.state={attachment:co(e),composerHeight:J.a.theme.componentDimensions.appBarHeight},this._showDMQuickAccess=k.b.isTrue("responsive_web_dm_quick_access_enabled")}componentDidMount(){const{googleAnalyticsPageView:e,scribeNamespace:t,scribePageImpression:i,updateTweetDetailNav:n}=this.props;return i(t),n(t),e(t),this._initializePolling({interval:3e3}),this._initializeLivePipeline(),this._focusComposerIfNeeded(),this._initialFetch()}_focusComposerIfNeeded(){hs()(()=>Object(os.a)().then(({detectedType:e,KEYBOARD:t,MOUSE:i})=>{const n=this.props.quickReplyOptions;(e(t)||e(i))&&!n&&this._currentComposer&&this._currentComposer.focus()}))}_initializeLivePipeline(){const{conversationId:e}=this.props;Object(s.h)().then(({LivePipeline:t})=>{e&&t.isSupportedAndReady(k.b)&&k.b.isTrue("livepipeline_dm_features_enabled")&&!this._livePipelineSubscription&&(this._livePipelineSubscription=t.get().subscribeTopic("/dm_update/"+e,this._handleLivePipelineUpdate),this._initializePolling({interval:1e4}))})}_initializePolling({interval:e}){this._updatePolling&&this._updatePolling.stop(),this._updatePolling=new gs.a(this._fetchUpdatesIfNeeded,{interval:e})}componentWillUnmount(){const{conversation:e,conversationId:t,removeConversation:i}=this.props,n=(null==e?void 0:e.entries)||[];this._updatePolling&&this._updatePolling.stop(),this._updatePolling=void 0,this._livePipelineSubscription&&this._livePipelineSubscription.teardown(),0===n.length&&i(t),1===n.length&&"welcome_message_create"===n[0].type&&i(t)}componentDidUpdate(e,t){const{conversationId:i,conversation:n,isLoaded:a,isUploading:r,quickReplyOptions:s,updateConversationReadState:o}=this.props;var c;i!==e.conversationId?(i&&this._fetchConversation(i),this._focusComposerIfNeeded(),this._livePipelineSubscription&&this._livePipelineSubscription.teardown(),this._initializeLivePipeline()):((null==n?void 0:n.sort_event_id)!==(null==(c=e.conversation)?void 0:c.sort_event_id)&&o(i),r||!e.isUploading||s||this._currentComposer&&this._currentComposer.focus(),e.isLoaded&&!a&&i&&this._fetchConversation(i))}UNSAFE_componentWillReceiveProps(e){const{media:t}=this.props,{media:i}=e;Object(ce.a)(t,i)||this.setState({attachment:co(e)})}render(){const{fetchStatus:e}=this.props;return r.createElement(Jr.a,{style:[uo.root,Ns.a.isKaiOS()&&uo.kaiOSFix]},r.createElement(ss.a,{fetchStatus:e,onRequestRetry:this._handleInitialFetch,render:this._render}))}_renderComposerBar(){const{addMedia:e,cardUrl:t,conversation:i,conversationId:n,dataSaverMode:a,draftText:s,dtabBarInfo:o,history:c,isUploading:l,mediaMetadata:d,mediaUploadProgress:u,quickReplyOptions:p,removeMedia:h,richTextInputContext:m,scribeNamespace:b,typeaheadWrapper:g}=this.props,{attachment:v}=this.state,f=this.props.prefillText||s,_=!Object(ms.a)();return(null==i?void 0:i.read_only)?null:r.createElement(rs.a,{attachment:v,conversationId:n,disabled:l,dtabBarInfo:o,history:c,isCardPreviewTombstoned:Object(cs.a)(t),isUploading:l,key:n,mediaMetadata:d,mediaUploadProgress:u,onAddMedia:e,onBlur:this._handleSaveDraftText,onHeightChange:this._handleNavHeightChange,onSend:this._handleSendMessage,onTyping:a?this._throttleSaveDraftText:this._handleTyping,prefillText:"string"==typeof f?f:void 0,quickReplyOptions:p,ref:this._composer,removeMedia:h,richTextInputContext:m,scribeNamespace:b,style:[!_&&uo.offsetBottom],typeaheadWrapper:g})}get _currentComposer(){return this._composer.current}_fetchConversation(e){const{createLocalApiErrorHandler:t,fetchConversationIfNeeded:i,updateConversationReadState:n}=this.props;return i({conversationId:e}).then(()=>n(e)).catch(t(Object(T.a)(e)))}_requestWelcomeMessage(e){const{addWelcomeMessageToConversation:t,createLocalApiErrorHandler:i,conversation:n,location:a}=this.props,{text:r}=a.query,s=Array.isArray(a.query.welcome_message_id)?a.query.welcome_message_id[0]:a.query.welcome_message_id,o=!!this.state.attachment||!(!r||s),l=!n||!n.type||n.type===c.CONVERSATION_TYPE.GROUP,d=n&&n.participants&&Object.keys(n.participants).length<=1;return o||l||d?Promise.resolve():t(e,s).catch(i({showToast:!1}))}}a()(lo,"defaultProps",{isNewGroupConversation:!1,typeaheadWrapper:ds.a});const uo=J.a.create(e=>({root:{flexGrow:1},activity:{flexBasis:"1px",flexGrow:1,height:"100%"},kaiOSFix:{paddingBottom:20},dragDrop:{flexGrow:1},scrollView:{flexGrow:1},infoButton:{marginRight:e.spaces.xxSmall},offsetBottom:{paddingBottom:J.a.iPhoneOffsetBottom}}));t.a=Object(M.c)()(O(lo))},"Q+Pg":function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"c",(function(){return a})),i.d(t,"b",(function(){return r})),i.d(t,"d",(function(){return s}));i("kYxP");const n="fleets",a=Object.freeze({REQUEST:"rweb/fleets/FETCH_USER_FLEETS_REQUEST",SUCCESS:"rweb/fleets/FETCH_USER_FLEETS_SUCCESS",FAILURE:"rweb/fleets/FETCH_USER_FLEETS_FAILURE"}),r="rweb/fleets/UPDATE_FLEET";function s(e,t){for(let i=0;i<t.sizes.length;i++){const n=t.sizes[i];if(n.size_type===e)return n}const[i]=t.sizes;return i}},"U+Jl":function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));i("IAdD");var n=i("ERkP"),a=i("xJf9"),r=i("8eiz"),s=i("rHpw"),o=i("MWbm");function c(e){const t=Object.assign({backgroundColor:e.color,transform:[{translate3d:`${e.translate.x}px, ${e.translate.y}px, 0`},{scale:""+e.scale}],opacity:e.opacity},Object(r.c)(e.size));return n.createElement(o.a,{style:[t,a.a.transitionTransform,l.audioCircle]})}c.defaultProps={color:s.a.theme.colors.white,opacity:.15};const l=s.a.create(e=>({audioCircle:{position:"absolute",borderRadius:e.borderRadii.infinite,pointerEvents:"none"}}))},"X/yg":function(e,t,i){"use strict";i.d(t,"e",(function(){return n})),i.d(t,"d",(function(){return a})),i.d(t,"c",(function(){return r})),i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return o}));const n=(e,t)=>t.location&&t.location.state&&t.location.state.tweetAttachment,a=(e,t)=>t.location&&t.location.state&&t.location.state.participants,r=(e,t)=>t.location&&t.location.state&&t.location.state.isNewGroupConversation,s=e=>{const{message_data:t}=e;let i="text_bubble";const n=t&&t.attachment||{};return n.tweet?i="tweet":n.photo?i="photo":n.animated_gif?i="gif":n.video?i=n.video.audio_only?"voice_message":"video":n.card&&(i="card"),i};function o(e,t){return!!(e&&e.video&&t.isTrue("dm_voice_rendering_enabled"))&&!!e.video.audio_only}},XnpN:function(e,t,i){"use strict";i("kYxP");var n=i("aWyx"),a=i("t0aI");const r=(e=0)=>new Date(Number(e)),s=(e,t)=>r(e.join_time)-r(t.join_time),o=({user:e},{user:t})=>Object(a.a)(e.id_str,t.id_str);var c=i("tn7R"),l=i("VIKJ");t.a=(e,t)=>{const{participants:i,type:a,created_by_user_id:r}=e,d=Object(c.a)(i),[u,p]=Object(l.a)(d,({user:e})=>e.id_str===t);return p.length?a===n.a.GROUP&&1===p.length?[...u,...p]:r?p.sort(((...e)=>(t,i)=>e.map(e=>e(t,i)).filter(e=>!!e)[0]||0)((e=>({user:t},{user:i})=>{switch(e){case t.id_str:return-1;case i.id_str:return 1;default:return 0}})(r),s,o)):p:u}},aA19:function(e,t,i){"use strict";var n=i("ERkP"),a=i("aWyx"),r=i("XnpN"),s=i("rHpw"),o=i("9Xij"),c=i("cm6r"),l=i("TIdA"),d=i("A91F"),u=i("oSwX"),p=i("U+bB"),h=i("MWbm");const m=s.a.create(e=>({root:{borderRadius:e.borderRadii.infinite,overflow:"hidden"},container:{height:"auto",overflow:"hidden",width:"100%"},image:{borderRadius:e.borderRadii.none}})),b=s.a.create(e=>({container:{flexDirection:"row"},left:{flex:1},right:{flex:1,marginLeft:e.borderWidths.small,marginRight:`calc(-1 * ${e.borderWidths.small})`}})),g=s.a.create(e=>({container:{flexDirection:"column"},top:{flex:1,marginBottom:e.borderWidths.small},bottom:{flex:1}})),v=({left:e,right:t})=>n.createElement(h.a,{style:b.container},n.createElement(h.a,{style:b.left},e),n.createElement(h.a,{style:b.right},t)),f=({top:e,bottom:t})=>n.createElement(h.a,{style:g.container},n.createElement(h.a,{style:g.top},e),n.createElement(h.a,{style:g.bottom},t));class _ extends n.Component{render(){const{link:e,conversation:t,perspective:i}=this.props,a=t&&t.avatar_image_https,s=t?Object(r.a)(t,i).map(({user:e})=>e):[],l=s.slice(0,3),d=this._avatarFromGroup(t)||this._avatarFromSrc(a)||this._avatarFromParticipants(l),u=e||this._defaultLink(t,s);return d?n.createElement(o.a,{ratio:1,style:m.root},u?n.createElement(c.a,{interactiveStyles:null,link:u},d):d):null}_defaultLink(e,t){if(e)return e.type===a.a.GROUP?`/messages/${e.conversation_id}/participants`:e.type===a.a.ONE_TO_ONE?"/"+t[0].screen_name:void 0}_avatarFromGroup(e){const t=e&&e.avatar&&e.avatar.image&&e.avatar.image.original_info;return t?n.createElement(l.a,{accessibilityLabel:"",aspectMode:d.a.SQUARE,backgroundColor:s.a.theme.colors.gray50,image:t,rounded:!0}):null}_avatarFromSrc(e){return e?n.createElement(p.a,{source:e}):null}_avatarFromParticipants(e){const t=e.length;return 0===t?null:1===t?this._singleParticipantAvatar(e[0]):this._multipleParticipantAvatar(e)}_singleParticipantAvatar(e){const{size:t}=this.props;return n.createElement(h.a,{key:e.id_str,style:m.container},n.createElement(u.default,{importantForAccessibility:"no-hide-descendants",size:t||"xxLarge",style:m.image,uri:e.profile_image_url_https}))}_multipleParticipantAvatar(e){const t=e.length,i=e.map((e,i)=>{const a=2===t||3===t&&0===i?.5:1;return n.createElement(h.a,{key:e.id_str,style:m.container},n.createElement(u.default,{aspectRatio:a,circle:!1,importantForAccessibility:"no-hide-descendants",size:"custom",style:m.image,uri:e.profile_image_url_https}))});if(2===t)return n.createElement(v,{left:i[1],right:i[0]});{const e=n.createElement(f,{bottom:i[2],top:i[1]}),t=i[0];return n.createElement(v,{left:e,right:t})}}}t.a=_},b9JY:function(e,t,i){"use strict";i.d(t,"b",(function(){return a})),i.d(t,"e",(function(){return r})),i.d(t,"d",(function(){return s})),i.d(t,"c",(function(){return o})),i.d(t,"a",(function(){return l}));var n=i("aWyx");const a=e=>e&&e.type===n.b.MESSAGE,r=e=>e&&e.type===n.b.WELCOME_MESSAGE,s=e=>e&&e.type===n.b.TRUST_CONVERSATION,o=e=>e&&e.type===n.b.REACTION_CREATE,c=[n.b.CONVERSATION_AVATAR_UPDATE,n.b.CONVERSATION_NAME_UPDATE,n.b.JOIN_CONVERSATION,n.b.PARTICIPANTS_JOIN,n.b.PARTICIPANTS_LEAVE],l=e=>e&&c.indexOf(e.type)>-1},cSHO:function(e,t,i){"use strict";i.d(t,"b",(function(){return d})),i.d(t,"d",(function(){return u})),i.d(t,"e",(function(){return h})),i.d(t,"c",(function(){return m})),i.d(t,"f",(function(){return b})),i.d(t,"a",(function(){return g})),i.d(t,"g",(function(){return v}));i("IAdD"),i("JtPf");var n=i("oEOe"),a=i("kGix"),r=i("Ssj5"),s=i("Q+Pg");const o={fleets:{},fleetThreads:{},userFetchStatus:{}};const c=(e,t)=>(null==t?void 0:t.data)?t.data.is_interstitialed:!!((null==e?void 0:e.tombstone)&&Object.keys((null==e?void 0:e.tombstone)||{}).length>0||(null==e?void 0:e.possibly_sensitive)||(null==e?void 0:e.tweet_possibly_sensitive)),l=(e,t)=>e[s.a].fleets[t],d=(e,t)=>{const i=l(e,t);return null==i?void 0:i.data},u=(e,t)=>{var i;return!!(null==(i=d(e,t))?void 0:i.is_interstitialed)},p=(e,t)=>((e,t)=>e[s.a].fleetThreads[t])(e,t),h=(e,t)=>{const i=d(e,t),n=null==i?void 0:i.fleet_thread_id;if(n){const t=p(e,n);return null==t?void 0:t.data}},m=(e,t)=>{const i=l(e,t);return(null==i?void 0:i.fetchStatus)||a.a.NONE},b=(e,t)=>e[s.a].userFetchStatus[t],g=(e,t)=>(i,r,{api:o})=>{const c=r(),l=t&&m(c,t),d=b(c,e),u=n.b(i,{params:{user_id:e},request:o.Fleets.fetchUserFleets});return d===a.a.LOADING||l===a.a.LOADED&&d===a.a.LOADED?Promise.resolve():u({actionTypes:s.c,context:"FETCH_USER_FLEETS",meta:{user_id:e,fleet_id:t}})},v=e=>(t,i)=>{const n=l(i(),e);(null==n?void 0:n.data)&&t({meta:{fleet_id:e},payload:{fetchStatus:n.fetchStatus,data:Object.assign({},n.data,{is_interstitialed:!1})},type:s.b})};r.a.register({[s.a]:function(e=o,t){switch(t.type){case s.c.REQUEST:{const{user_id:i,fleet_id:n}=t.meta;let r;return n&&!e.fleets[n]&&(r={[n]:{fetchStatus:a.a.LOADING}}),Object.assign({},e,{userFetchStatus:Object.assign({},e.userFetchStatus,{[i]:a.a.LOADING}),fleets:Object.assign({},e.fleets,r)})}case s.c.SUCCESS:var i;if(null==(i=t.payload)?void 0:i.entities){const{fleets:i,fleetThreads:n}=t.payload.entities,{user_id:r,fleet_id:s}=t.meta;let o={},l={};i&&(o=Object.keys(i).reduce((t,n)=>{const r=i[n],s=e.fleets[n];return r.is_interstitialed=c(r,s),t[n]={fetchStatus:a.a.LOADED,data:r},t},{})),n&&(l=Object.keys(n||{}).reduce((e,t)=>(e[t]={fetchStatus:a.a.LOADED,data:n[t]},e),{}));const d=s&&!o[s]&&{[s]:Object.assign({},e.fleets[s],{fetchStatus:a.a.FAILED})};return Object.assign({},e,{fleets:Object.assign({},e.fleets,o,d),fleetThreads:Object.assign({},e.fleetThreads,l),userFetchStatus:Object.assign({},e.userFetchStatus,{[r]:a.a.LOADED})})}break;case s.c.FAILURE:{const{user_id:i,fleet_id:n}=t.meta,r=n&&e.fleets[n].fetchStatus===a.a.LOADING&&{[n]:Object.assign({},e.fleets[n],{fetchStatus:a.a.FAILED})};return Object.assign({},e,{fleets:Object.assign({},e.fleets,r),userFetchStatus:Object.assign({},e.userFetchStatus,{[i]:a.a.FAILED})})}case s.b:{const{meta:{fleet_id:i},payload:n}=t;return Object.assign({},e,{fleets:Object.assign({},e.fleets,{[i]:n})})}default:return e}}})},g54k:function(e,t,i){"use strict";i.d(t,"b",(function(){return c}));var n=i("oEGd"),a=i("hqKg"),r=i("s1N3");var s=e=>{const{sender_id:t,by_user_id:i,participants:n=[]}=e;return Object(r.a)(n.map(({user_id:e})=>e).concat([t,i]).filter(Boolean))},o=i("G6rE");const c=(e,t)=>({users:s(t).reduce((t,i)=>(t[i]=e[i],t),{})}),l=Object(a.createSelector)(o.e.selectAll,(e,t)=>t.entry,c);t.a=Object(n.c)(l)},hiGS:function(e,t,i){"use strict";i("IAdD");var n=i("ERkP"),a=i("Lsrn"),r=i("k/Ka");const s=(e={})=>Object(r.a)("svg",Object.assign({},e,{style:[a.a.root,e.style],viewBox:"0 0 24 24"}),n.createElement("g",null,n.createElement("path",{d:"M20.746 5.236h-3.75V4.25c0-1.24-1.01-2.25-2.25-2.25h-5.5c-1.24 0-2.25 1.01-2.25 2.25v.986h-3.75c-.414 0-.75.336-.75.75s.336.75.75.75h.368l1.583 13.262c.216 1.193 1.31 2.027 2.658 2.027h8.282c1.35 0 2.442-.834 2.664-2.072l1.577-13.217h.368c.414 0 .75-.336.75-.75s-.335-.75-.75-.75zM8.496 4.25c0-.413.337-.75.75-.75h5.5c.413 0 .75.337.75.75v.986h-7V4.25zm8.822 15.48c-.1.55-.664.795-1.18.795H7.854c-.517 0-1.083-.246-1.175-.75L5.126 6.735h13.74L17.32 19.732z"}),n.createElement("path",{d:"M10 17.75c.414 0 .75-.336.75-.75v-7c0-.414-.336-.75-.75-.75s-.75.336-.75.75v7c0 .414.336.75.75.75zm4 0c.414 0 .75-.336.75-.75v-7c0-.414-.336-.75-.75-.75s-.75.336-.75.75v7c0 .414.336.75.75.75z"})));s.metadata={width:24,height:24},t.a=s},"n+Zb":function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"a",(function(){return a}));const n=e=>({id:e,distanceToViewportTop:0}),a=e=>({id:e,distanceToViewportBottom:0})},p9G8:function(e,t,i){"use strict";i.d(t,"b",(function(){return d}));i("kYxP");var n=i("Xrkv"),a=i("aWyx"),r=i("XnpN"),s=i("3XMw"),o=i.n(s);const c=o.a.g755fcde,l=o.a.f6b1ff81;t.a=(e,t)=>{const{type:i,name:n,participants:s={}}=e;if(i===a.a.GROUP&&n)return n;if(!Object.keys(s).length)return;const o=Object(r.a)(e,t).map(({user:e})=>e);return d(o,t,i)};const d=(e=[],t,i=a.a.GROUP)=>{const r=e.filter(e=>e.id_str!==t).map(e=>e.name);switch(r.length){case 0:return c;case 1:{const[e]=r;return i===a.a.GROUP?l({name:e}):e}default:{const e=!0;return Object(n.a)(r,e)}}}},uB9N:function(e,t,i){"use strict";i("IAdD"),i("DZ+c"),i("tVqn");var n=i("KEM+"),a=i.n(n),r=i("ERkP"),s=i("1YZw"),o=i("rxPX"),c=i("zh9S"),l=i("P1r1"),d=i("AspN"),u=Object(o.a)().propsFromState(()=>({dataSaverMode:l.k})).propsFromActions(()=>({addMedia:d.b,addToast:s.b,processMultipleMedia:d.d,removeMediaUpload:d.e,scribeAction:c.c,uploadMedia:d.k})),p=i("wpu3"),h=i("97Jx"),m=i.n(h),b=i("MWbm"),g=i("0FVZ"),v=i("Oe3h");class f extends r.PureComponent{render(){const{accessibilityLabel:e,accessibilityRole:t,children:i,onLayout:n,sideNavPresent:a,style:s}=this.props;return a?r.createElement(r.Fragment,null,r.createElement(b.a,{accessibilityLabel:e,accessibilityRole:t,onLayout:n,style:s},i)):r.createElement(g.a.BottomComposer,null,r.createElement(v.a,{id:"DMComposerWrapper"},(a,o)=>r.createElement(b.a,m()({ref:a()},o({accessibilityLabel:e,accessibilityRole:t,onLayout:n,style:s})),i)))}}var _=f,y=(i("jQ/y"),i("kYxP"),i("HPNB")),E=i("htQn"),C=i("t62R"),S=i("rHpw");class x extends r.Component{constructor(...e){super(...e),a()(this,"_handleClick",()=>{const{id:e,label:t,onClick:i}=this.props;i({id:e,label:t})})}render(){const{description:e,label:t,isWide:i}=this.props;return r.createElement(E.a,{accessibilityRole:"button",onClick:this._handleClick,style:[R.root,i&&R.isWide,!i&&R.isNarrow]},r.createElement(C.c,{weight:"bold"},t),r.createElement(C.c,{color:"gray600",size:"small"},e))}}const R=S.a.create(e=>({root:{backgroundColor:e.colors.cellBackground,borderColor:e.colors.borderColor,borderStyle:"solid",paddingLeft:"1rem",paddingVertical:"1rem"},isWide:{borderRadius:e.borderRadii.xLarge,paddingVertical:"0.5rem",borderWidth:e.borderWidths.small},isNarrow:{borderTopWidth:e.borderWidths.small}}));var A=x,w=i("cHvH"),I=i("mw9i");class O extends r.Component{constructor(...e){super(...e),a()(this,"_handleOptionChoose",e=>{const{onOptionChoose:t,quickReplyOptions:{id:i}}=this.props;return t(i,e)})}render(){const{quickReplyOptions:{options:e}}=this.props,t=1===e.length;return r.createElement(w.a,null,({windowWidth:i})=>{const n=y.a.isTwoColumnLayout(i),a=[n&&M.isWide,n&&t&&M.oneButtonOnly,!n&&M.isNarrow];return r.createElement(I.a,{style:a,withGutter:n},e.map(e=>this.renderOption(e,n)))})}renderOption(e,t){return r.createElement(A,{description:e.description,id:e.id,isWide:t,key:e.id,label:e.label,onClick:this._handleOptionChoose})}}const M=S.a.create(e=>({oneButtonOnly:{gridTemplateColumns:"1fr"},isWide:{backgroundColor:e.colors.gray0,display:"grid",gridColumnGap:e.spaces.xSmall,gridRowGap:e.spaces.xSmall,gridTemplateColumns:"1fr 1fr",paddingVertical:e.spaces.xSmall},isNarrow:{maxHeight:"168px",overflow:"auto"}}));var T=O,k=i("krmn"),L=i("cIoY"),D=i("w3n3"),F=i("MLl7"),P=i("3XMw"),j=i.n(P),B=i("J2UM"),N=i("VPdC"),U=i("pKoL"),W=i("eyty"),H=i("oQhu"),z=i("JYMr");class V extends r.Component{constructor(...e){super(...e),a()(this,"state",{currentStepIndex:-1})}componentDidMount(){this._scheduleNextStep(0)}componentWillUnmount(){this._currentTimeoutId&&clearTimeout(this._currentTimeoutId)}render(){const{steps:e}=this.props,{currentStepIndex:t}=this.state,i=t>=0&&t<e.length?e[t].progress:0;return r.createElement(z.a,{progress:i})}_scheduleNextStep(e){const{steps:t}=this.props;e<t.length&&(this._currentTimeoutId=setTimeout(()=>{this._currentTimeoutId=void 0,this.setState({currentStepIndex:e}),this._scheduleNextStep(e+1)},t[e].waitMs))}}a()(V,"defaultProps",{steps:[{waitMs:1e3,progress:.1},{waitMs:1400,progress:.3},{waitMs:1800,progress:.5},{waitMs:2400,progress:.6},{waitMs:3e3,progress:.9}]});class q extends r.PureComponent{render(){const{isSending:e,isUploading:t,progress:i}=this.props;return e&&!t?r.createElement(V,null):r.createElement(z.a,{progress:e?Math.max(i,.02):0})}}var G=q,Q=i("Dtul"),Y=i("Es6L"),K="dmComposerAttachments",$="dmComposerTextInput",J="dmComposerSendButton",X=i("GZwR"),Z=i("aITJ"),ee=i("6OUF"),te=i("9Xij"),ie=i("/yvb"),ne=i("gpVt"),ae=i("Lsrn"),re=i("k/Ka");const se=(e={})=>Object(re.a)("svg",Object.assign({},e,{style:[ae.a.root,e.style],viewBox:"0 0 24 24"}),r.createElement("g",null,r.createElement("path",{d:"M21.13 11.358L3.614 2.108c-.29-.152-.64-.102-.873.126-.23.226-.293.577-.15.868l4.362 8.92-4.362 8.92c-.143.292-.08.643.15.868.145.14.333.212.523.212.12 0 .24-.028.35-.087l17.517-9.25c.245-.13.4-.386.4-.664s-.155-.532-.4-.662zM4.948 4.51l12.804 6.762H8.255l-3.307-6.76zm3.307 8.26h9.498L4.948 19.535l3.307-6.763z"})));se.metadata={width:24,height:24};var oe=se;const ce=(e={})=>Object(re.a)("svg",Object.assign({},e,{style:[ae.a.root,e.style],viewBox:"0 0 24 24"}),r.createElement("g",null,r.createElement("path",{d:"M19 13.5H5c-.828 0-1.5-.672-1.5-1.5s.672-1.5 1.5-1.5h14c.828 0 1.5.672 1.5 1.5s-.672 1.5-1.5 1.5zm0 6H5c-.828 0-1.5-.672-1.5-1.5s.672-1.5 1.5-1.5h14c.828 0 1.5.672 1.5 1.5s-.672 1.5-1.5 1.5zm0-12H5c-.828 0-1.5-.672-1.5-1.5S4.172 4.5 5 4.5h14c.828 0 1.5.672 1.5 1.5s-.672 1.5-1.5 1.5z"})));ce.metadata={width:24,height:24};var le=ce;const de=(e={})=>Object(re.a)("svg",Object.assign({},e,{style:[ae.a.root,e.style],viewBox:"0 0 24 24"}),r.createElement("g",null,r.createElement("path",{d:"M19 13H5c-.553 0-1-.447-1-1s.447-1 1-1h14c.553 0 1 .447 1 1s-.447 1-1 1zm0 6H5c-.553 0-1-.447-1-1s.447-1 1-1h14c.553 0 1 .447 1 1s-.447 1-1 1zm0-12H5c-.553 0-1-.447-1-1s.447-1 1-1h14c.553 0 1 .447 1 1s-.447 1-1 1z"})));de.metadata={width:24,height:24};var ue=de,pe=i("iySH");const he=j.a.ee230734,me=j.a.ca0ce0e4,be=j.a.cdcebd22,ge=j.a.e3275464,ve=j.a.ic8c615d,fe=j.a.a04077c4,_e=e=>!(!e||!e.media),ye=Object(p.b)({maxNumberOfPhotos:1}),Ee=r.createElement(oe,null);class Ce extends r.Component{constructor(e,t){super(e,t),a()(this,"_handleLayout",e=>{const{onHeightChange:t}=this.props,{mediaButtonsCollapsible:i}=this.state,n=e.nativeEvent.layout;n&&(Object(Y.a)()||t&&t(n.height),n.width<=S.a.theme.breakpoints.small&&!i?this.setState({mediaButtonsCollapsible:!0}):n.width>S.a.theme.breakpoints.small&&i&&this.setState({mediaButtonsCollapsible:!1}))}),a()(this,"_renderQuickReplyPicker",()=>{const{quickReplyOptions:e}=this.props,{isQuickReplyOpen:t}=this.state;return e&&t?r.createElement(T,{onOptionChoose:this._handleQROptionSelection,quickReplyOptions:e}):null}),a()(this,"_renderComposeBox",()=>r.createElement(b.a,{style:Se.composeBoxContainer},this._renderMainContent())),a()(this,"_renderMainContent",()=>{const{typeaheadWrapper:e}=this.props,{value:t}=this.state,i=e;return i?r.createElement(i,{contextText:t,isInline:!0,onTextUpdated:this._handleTextChange,onTypeaheadStateChange:this._handleTypeaheadStateChange,source:X.d.ComposeMessage},this._renderFieldTextInput):this._renderFieldTextInput()}),a()(this,"_renderFieldTextInput",e=>{const{disabled:t,placeholderText:i,richTextInputContext:n}=this.props,a=Z.a.isKaiOS()?be:i||me,{editorState:s,value:o}=this.state,c=!!n,l=n?{editorState:s,element:n.element}:void 0;return r.createElement(ee.a,{contentAbove:this._renderAttachments(),editable:!t,emojiPickerButton:this._renderEmojiPicker(),handleReturn:c?this._handleReturn:void 0,inputStyle:Se.composeTextInput,maxNumberOfLines:c?8:4,multiline:!0,numberOfLines:1,onBlur:this._handleOnBlur,onChange:e?this._getHandleChange(e):this._handleTextChange,onFilesAdded:this._handleAddMediaFiles,onFocus:this._handleTextInputFocus,onKeyPress:c?void 0:this._handleReturn,placeholder:a,ref:this._setTextInputRef,richTextInputContext:l,style:Se.composeInput,testID:$,useCacheForDOMMeasurements:!this._isSendDisabled(),value:o})}),a()(this,"_getHandleChange",Object(H.a)(e=>t=>{e(t),this._handleTextChange(t)})),a()(this,"_handleTypeaheadStateChange",e=>{this.setState({isTypeaheadActive:e})}),a()(this,"_renderAttachments",()=>{const{attachment:e,conversationId:t,isCardPreviewTombstoned:i,isShareViaDM:n,isUploading:a,mediaMetadata:s}=this.props,{value:o}=this.state,{height:c,width:l}=e&&(e.media&&e.media.mediaFile||e.provider&&e.media&&e.media.externalMediaDetails)||{},d=null==e?void 0:e.media,u=d&&d.id.toString(),p=s&&u&&s[u]&&s[u].altText,h=s&&u&&s[u]&&s[u].defaultAltText,m=Object(ne.b)(o);return r.createElement(r.Fragment,null,d?r.createElement(b.a,{style:Se.attachmentContainer,testID:K},r.createElement(te.a,{ratio:l/c,style:Se.aspectContainer},r.createElement(b.a,{style:Se.mediaPreviewContainer},r.createElement(U.a,{accessibilityLabel:p||h,mediaItem:d,onClick:this.canEditImage?this._handleClickMediaDetail:void 0,onEdit:this.canEditImage?this._handleClickMediaDetail:void 0,onRemove:this._handleRemoveMedia(d.id),resizeIfNeeded:"width",style:[Se.mediaPreview],withAltTextLabel:!!p,withCloseButton:!a,withEditButton:this.canEditImage&&!a}))),e&&e.provider&&e.gifUrl&&r.createElement(b.a,{style:Se.gifAttribution},r.createElement(L.a,{gifUrl:e.gifUrl,provider:e.provider}))):m&&!n?r.createElement(ne.a,{conversationId:t,isCardPreviewTombstoned:i,style:Se.cardPreviewContainer,urls:m}):null)}),a()(this,"_renderEmojiPicker",()=>{const{withEmojiPicker:e}=this.props;return e&&Z.a.isDesktopOS()?r.createElement(k.a,{disabled:this.props.disabled,onEmojiSelect:this._handleEmojiSelect,onPress:this._handleTextInputFocus,size:"normalCompact",textInputRef:this._textInput||void 0}):null}),a()(this,"_renderActionButton",e=>{const{quickReplyOptions:t}=this.props,i=this._hasMessageText();return!t||i||e?r.createElement(ie.a,{accessibilityLabel:ge,disabled:this._isSendDisabled(),icon:Ee,onPress:this._handleSend,size:"normal",style:Se.actionButton,testID:J,type:"text"}):this._renderQRToggleButton()}),a()(this,"_renderQRToggleButton",()=>{const{isQuickReplyOpen:e}=this.state;return r.createElement(ie.a,{accessibilityLabel:ve,icon:e?r.createElement(le,null):r.createElement(ue,null),onPress:this._handleQuickReplyPickerToggle,size:"normal",style:Se.actionButton,type:"text"})}),a()(this,"_renderComposer",()=>{const{attachment:e}=this.props,t=_e(e),i=this._renderComposeBox(),n=this._renderActionButton(t);return r.createElement(b.a,{style:[Se.composer,t&&Se.composerWithAttachment]},t?null:this._renderMediaButtons(),i,n)}),a()(this,"_renderMediaButtons",()=>{const{withGifPicker:e,withMediaPicker:t}=this.props,{mediaButtonsCollapsed:i,mediaButtonsCollapsible:n}=this.state,a=n&&i;return r.createElement(b.a,{style:Se.uploadButtons},a?r.createElement(ie.a,{accessibilityLabel:he,icon:r.createElement(pe.a,null),onMouseDown:this._handleShowMediaControlsMouseDown,type:"text"}):null,t&&!a?this._renderMediaPicker():null,e&&!a?this._renderGifButton():null)}),a()(this,"_handleShowMediaControlsMouseDown",()=>{const{scribeAction:e,scribeNamespace:t}=this.props;this.setState({mediaButtonsCollapsed:!1}),e(Object.assign({},t,{component:"dm_composer",element:"toggle",action:"expand"}))}),a()(this,"_handleReturn",e=>{const{nativeEvent:{ctrlKey:t,key:i,metaKey:n,shiftKey:a}}=e,r="Enter"===i,{isTypeaheadActive:s}=this.state;if(!s&&r&&this._keyboardOrMouseDetected&&!(a||n||t))return e.preventDefault(),this._handleSend(e),"handled"}),a()(this,"_handleClickMediaDetail",()=>{const{attachment:e,conversationId:t,history:i}=this.props;if(this.canEditImage){const n=e&&e.media?e.media.id:0;i.push("/messages/compose/media",{mediaId:n,conversationId:t,tab:"crop"})}}),a()(this,"_handleAddMediaFiles",e=>{const{addMedia:t,addToast:i,dataSaverMode:n,onAddMedia:a,processMultipleMedia:r,removeMediaUpload:s,removeMedia:o,uploadMedia:c}=this.props;t(e,{location:W.c.Dm}).then(e=>{const t=e.map(e=>e.id);this._validateMedia(e)?(a&&a(t),r(e,{onFailure:o}).then(e=>{n||c(e.map(e=>e.id),{preUpload:!0})})):(i({text:fe}),s(t))})}),a()(this,"_handleEmojiSelect",e=>{const{editorState:t}=this.state,{richTextInputContext:i}=this.props;if(!i)return;const n=i.insertTextAtCursor(t,e.text);this._handleTextChange(n)}),a()(this,"_handleRemoveMedia",e=>()=>{this.props.removeMedia&&this.props.removeMedia(e)}),a()(this,"_handleSend",e=>{if(!this._isSendDisabled()){const{onSend:t}=this.props;this._textInput&&this._textInput.applyFinalValue(i=>{t(e,i)}),this._closeQuickReplyPicker()}}),a()(this,"_handleTextChange",e=>{const{onTyping:t,richTextInputContext:i}=this.props,{value:n}=this.state;let a;if(i){const t=e.getCurrentContent().getPlainText(),n=i.convertEmojiToEntities(e);a=t,this.setState({editorState:n,value:a})}else a=e.target.value,this.setState({value:a});n!==a&&t&&t()}),a()(this,"_handleOnBlur",()=>{const{onBlur:e}=this.props,{mediaButtonsCollapsible:t}=this.state;e&&e(),t&&this.setState({mediaButtonsCollapsed:!1})}),a()(this,"_handleTextInputFocus",()=>{const{quickReplyOptions:e}=this.props,{isQuickReplyOpen:t,mediaButtonsCollapsible:i}=this.state;e&&t&&this._closeQuickReplyPicker(),i&&this.setState({mediaButtonsCollapsed:!0})}),a()(this,"_handleQROptionSelection",(e,t)=>{const{onSend:i,disabled:n}=this.props;n||(i({quickReply:{id:e,selected_id:t.id}},t.label),this._closeQuickReplyPicker())}),a()(this,"_handleQuickReplyPickerToggle",()=>{this.setState({isQuickReplyOpen:!this.state.isQuickReplyOpen})}),a()(this,"_validateMedia",e=>!_e(this.props.attachment)&&ye(e)),a()(this,"_detectKeyboardOrMouse",e=>{const{registerSome:t,KEYBOARD:i,MOUSE:n}=e;t(()=>{this._keyboardOrMouseDetected=!0},[i,n])}),a()(this,"_isSendDisabled",()=>{const{attachment:e,canSendEmptyMessage:t,disabled:i,isUploading:n}=this.props,a=_e(e),r=this._hasMessageText()||t,s=!(!e||!e.media)&&(e.media.needsProcessing||n);return i||!r&&!a||s||n}),a()(this,"_hasMessageText",()=>!!(this.state.value||"").trim()),a()(this,"_closeQuickReplyPicker",()=>{this.setState({isQuickReplyOpen:!1})}),a()(this,"_setTextInputRef",e=>{this._textInput=e});const{richTextInputContext:i,prefillText:n}=e,{initEditorState:s}=i||{};this.state={isQuickReplyOpen:!0,value:n,editorState:s&&s(n),isTypeaheadActive:!1,mediaButtonsCollapsed:!1,mediaButtonsCollapsible:!1}}componentDidMount(){Object(B.a)().then(this._detectKeyboardOrMouse),this._unlockReload=Q.a.acquire()}componentWillUnmount(){this._unlockReload()}componentDidUpdate(){this.props.quickReplyOptions&&this.state.isQuickReplyOpen&&this._textInput&&this._textInput.blur()}UNSAFE_componentWillReceiveProps(e){const t=this.props.quickReplyOptions,i=e.quickReplyOptions;t&&!i?this.setState({isQuickReplyOpen:!1}):(!t&&i||t&&i&&t.id!==i.id)&&this.setState({isQuickReplyOpen:!0}),this.props.conversationId!==e.conversationId&&this.clear()}render(){const{dtabBarInfo:e,placeholderText:t,mediaUploadProgress:i,isSending:n,isUploading:a,style:s}=this.props,o=t||me,c=Object(Y.a)(),l=c&&e&&(e.dtabAll||e.ttsToken)&&!e.hide;return r.createElement(_,{accessibilityLabel:o,accessibilityRole:"complementary",onLayout:this._handleLayout,sideNavPresent:c,style:[Se.root,l&&Se.dtabOffset,s]},r.createElement(G,{isSending:n,isUploading:a,progress:n?Math.max(i,.02):0}),this._renderComposer(),this._renderQuickReplyPicker())}_renderMediaPicker(){return r.createElement(N.a,{onChange:this._handleAddMediaFiles,style:Se.mediaPicker,type:"text"})}_renderGifButton(){const{conversationId:e,history:t}=this.props;return r.createElement(D.a,{dmConversationId:e,enabled:!0,gifSearchKeySource:F.a.DMComposition,history:t})}get canEditImage(){const{attachment:e}=this.props;return!!(e&&e.media&&e.media.mediaFile&&e.media.mediaFile.isImage)}clear(){const{richTextInputContext:e}=this.props;if(e){const{initEditorState:t}=e||{};this.setState({value:"",editorState:t&&t("")})}else this.setState({value:""})}focus(){this._textInput&&this._textInput.focus()}value(){return this.state.value}}a()(Ce,"defaultProps",{prefillText:"",withEmojiPicker:!0,withGifPicker:!0,withMediaPicker:!0});const Se=S.a.create(e=>({root:{backgroundColor:e.colors.navigationBackground,borderTopColor:e.colors.borderColor,borderTopWidth:e.borderWidths.small},attachmentContainer:{maxHeight:"10rem",margin:e.spaces.xSmall},aspectContainer:{flexShrink:1},cardPreviewContainer:{margin:e.spaces.xSmall},dtabOffset:{marginBottom:e.spaces.xLarge},gifAttribution:{flexDirection:"row",marginVertical:e.spaces.xxSmall,marginHorizontal:0},mediaPicker:{margin:0},icon:{color:e.colors.primary,fontSize:"1.5em"},composeBoxContainer:{flexGrow:1,flexShrink:1,alignSelf:"center"},composeInput:{width:"100%"},composeTextInput:{paddingVertical:e.spaces.xxSmall},mediaPreviewContainer:{flexDirection:"row",height:"100%"},mediaPreview:{borderRadius:e.borderRadii.xLarge,overflow:"hidden"},composer:{alignItems:"flex-end",flexDirection:"row",padding:e.spaces.xxSmall,width:"100%"},composerWithAttachment:{paddingLeft:e.spaces.xSmall},actionButton:{marginLeft:e.spaces.xxSmall},uploadButtons:{flexDirection:"row",marginRight:e.spaces.xxSmall}}));t.a=u.forwardRef(Ce)},wJQ9:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"c",(function(){return r})),i.d(t,"b",(function(){return s}));i("IAdD");var n=i("kGix");const a=Object.assign({},n.a,{EXPIRED:"expired"}),r=Object.freeze({Original:"ORIG",Large:"LARGE",Medium:"MEDIUM",Small:"SMALL",Thumb:"THUMB"}),s=Object.freeze({Gif:"TWEET_GIF",Image:"TWEET_IMAGE",Video:"TWEET_VIDEO"});Object.freeze({Hashtag:"hashtag",Mention:"mention",Tweet:"tweet",Text:"text"})},xJf9:function(e,t,i){"use strict";var n=i("rHpw");t.a=n.a.create(e=>({transitionTransform:{transitionProperty:"transform",transitionDuration:"400ms",transitionTimingFunction:"cubic-bezier(0.215, 0.610, 0.355, 1.000)"}}))},zQEV:function(e,t,i){"use strict";i.d(t,"b",(function(){return p})),i.d(t,"a",(function(){return m}));var n=i("ERkP"),a=i("t62R"),r=i("aWyx"),s=i("3XMw"),o=i.n(s);const c=o.a.c1d4ac83,l=o.a.abc7b032,d=o.a.i263b293,u=({conversationId:e,children:t})=>n.createElement(a.c,{link:`/messages/${e}/participants`},t),p=(e,t)=>e>=2?n.createElement(o.a.I18NFormatMessage,{$i18n:"e3534476"},n.createElement(u,{conversationId:t},o.a.d1242bcc({count:e}))):n.createElement(o.a.I18NFormatMessage,{$i18n:"b6656850",count:e}),h=({entry:e,users:t})=>e.participants?n.createElement("span",null,e.participants.map(({user_id:e},i)=>{const r=t[e];return r?n.createElement("span",{key:i},i>0?", ":null,n.createElement(a.c,null,r.name)):null})):null,m=(e,t,i,s)=>{const u=i===e.by_user_id;let p;switch(t){case r.b.CONVERSATION_AVATAR_UPDATE:return p=e.by_user_id&&s[e.by_user_id]&&s[e.by_user_id].name,p?u?c:(e=>n.createElement(o.a.I18NFormatMessage,{$i18n:"bff29c94"},n.createElement(a.c,null,e)))(p):l;case r.b.CONVERSATION_NAME_UPDATE:{const t=n.createElement(a.c,null,e.conversation_name);return p=e.by_user_id&&s[e.by_user_id]&&s[e.by_user_id].name,p?u?(e=>n.createElement(o.a.I18NFormatMessage,{$i18n:"b16e4d45"},e))(t):((e,t)=>n.createElement(o.a.I18NFormatMessage,{$i18n:"c5760698"},n.createElement(a.c,null,e),t))(p,t):(e=>n.createElement(o.a.I18NFormatMessage,{$i18n:"a72730a0"},e))(t)}case r.b.JOIN_CONVERSATION:return p=e.sender_id&&s[e.sender_id]&&s[e.sender_id].name,p?(e=>n.createElement(o.a.I18NFormatMessage,{$i18n:"fa95b019"},n.createElement(a.c,null,e)))(p):d;case r.b.PARTICIPANTS_LEAVE:return(e=>n.createElement(o.a.I18NFormatMessage,{$i18n:"fc10875e"},e))(n.createElement(h,{entry:e,users:s}));case r.b.PARTICIPANTS_JOIN:p=e.sender_id&&s[e.sender_id]&&s[e.sender_id].name;return((e,t)=>e?n.createElement(o.a.I18NFormatMessage,{$i18n:"a4bc88c2"},n.createElement(a.c,null,e),t):n.createElement(o.a.I18NFormatMessage,{$i18n:"bfdff0c3"},t))(p,n.createElement(h,{entry:e,users:s}));default:return""}}}}]);
//# sourceMappingURL=https://ton.twitter.com/responsive-web-internal/sourcemaps/client-web/shared~loader.DMDrawer~bundle.DirectMessages~bundle.DMRichTextCompose.172be945.js.map